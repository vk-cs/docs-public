include:
  - project: infra/common/ci-templates
    ref: master
    file: pipelines/frontend.yml

variables:
  # pipeline parameters
  VKCS_DOCKERFILE_PATH: Dockerfile
  VKCS_BRANCH_PREVIEW_ENABLED: "true"
  VKCS_DEPLOY_PROD_ENABLED: "false"
  VKCS_DEPLOY_STAGE_ENABLED: "false"
  VKCS_DEPLOY_AMS_ENABLED: "false"

Healthcheck links for branch:
  stage: deploy_stage
  needs:
    - "Build image"
    - "Deploy Branch"
  image: stage-registry.infra.devmail.ru/$CI_PROJECT_PATH:$IMAGE_TAG
  script:
    - cd /home/node/app
    - npm run fullHealthyLinks
  variables:
    base404CheckUrl: "https://$CI_COMMIT_REF_SLUG.ingress.infra.devmail.ru"
    NODE_TLS_REJECT_UNAUTHORIZED: 0
  rules:
    - if: $CI_MERGE_REQUEST_ID

Deploy to Stage and Prod:
  stage: .post
  inherit:
    variables: false
  trigger:
    project: infra/front/new-help
    strategy: depend
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
