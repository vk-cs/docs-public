Данная статья описывает установку стека FAMP на операционную систему семейства Unix - FreeBSD 10.3.

Стек FAMP включает в себя операционную систему FreeBSD, веб-сервер Apache, систему управления базами данных MySQL (mariadb) и серверный язык сценариев для обработки динамического контента PHP. Все это необходимо для поддержки динамических сайтов и веб-приложений.

#### Требования

- Операционная система FreeBSD версии 10.3.
- Пользователь с доступом к команде sudo.

## Подготовка к установке стека FAMP

Перед установкой стека FAMP:

1.  Откройте файл resolv.conf для редактирования, выполнив команду:

```
sudo ee /etc/resolv.conf
```

2.  В файле resolv.conf выполните следующее:

- добавьте строку **nameserver <IP-адрес вашего DNS-сервера>**;

**Внимание**

Если вы используйте виртуальную машину, предоставляемую облачным сервисом [https://mcs.mail.ru/](https://mcs.mail.ru/), в строке **nameserver 8.8.8.8** просто удалите символ #.

- строку **nameserver 127.0.0.1** оставьте без изменения;
- cохраните изменения, выполнив следующее:
  - откройте меню, используя сочетание клавиш CTRL+[;
  - в меню выберите пункт **a**, затем снова выберите пункт **а**;

**![](./assets/1557001052099-1557001052099.jpeg)**

![](./assets/1557000622996-1557000622996.jpeg)

В результате содержимое файла resolv.conf должно выглядеть примерно так:

**![](./assets/1557001090271-1557001090271.jpeg)**

3.  Для сетевого интерфейса укажите корректное значение параметра mtu. Для этого:

**Примечание**

Чтобы узнать корректное значение mtu, обратитесь к вашему интернет-провайдеру

- выполните команду:

```
ifconfig
```

- для нужного сетевого интерфейса найдите параметр **mtu <значение>**, например:

**![](./assets/1557001285314-1557001285314.jpeg)**

- укажите новое значение mtu, выполнив команду:

```
sudo ifconfig <имя сетевого интерфейса> mtu <значение> up
```

**Примечание**

Если вы используйте виртуальную машину, предоставляемую облачным сервисом [https://mcs.mail.ru/](https://mcs.mail.ru/), выполните команду:

```
sudo ifconfig vtnet0 mtu 1400 up
```

- Для проверки внесенных изменений используйте команду:

```
ping cms.mail.ru
```

Убедитесь, что обмен запросами происходит успешно. Затем прервите выполнение команды, используя сочетание клавиш CTRL + C.

4.  Для отображения пакетов, доступных для обновления, и файлов, которые будут изменены в процессе обновления, выполните команду:

```
sudo freebsd-update fetch .
```

5.  Запустите процесс обновления, выполнив команду:

```
sudo freebsd-update install

```

## Установка и настройка веб-сервера Apache

Чтобы установить и выполнить первичную настройку веб-сервера Apache:

1.  Проверьте доступные версии Apache, выполнив команду:

```
ls /usr/ports/www/ | grep apache
```

2.  Выберите версию Apache (например, **apache24**) и запустите установку, выполнив команду:

```
sudo pkg install apache24
```

**Внимание**

При установке сервера Apache может потребоваться обновление пакета установщика pkg. Для обновления ответьте **Y**(es).

3.  Чтобы при перезагрузке операционной системы сервис Apache запускался автоматически, выполните команду:

```
sudo sysrc apache24_enable="yes"
```

4.  Запустите сервер Apache, выполнив команду:

```
sudo service apache24 start
```

5.  Для проверки работы Apache в адресной строке веб-браузера введите:

```
<внешний IP-адрес веб-сервера>/index.html
```

Если установка веб-сервера Apache прошла успешно, загрузится страница веб-сервера, содержащая строку:

![](./assets/1557001866811-1557001866810.jpeg)

## Установка СУБД MySQL (mariadb)

В качестве базы данных рассматривается установка mariadb, которая является ответвлением от СУБД MySQL. Чтобы установить и настроить mariadb:

1.  Откройте окно терминала.

2.  Проверьте доступные версии mariadb, выполнив команду:

```
pkg search -o mariadb
```

![](./assets/1557002384498-1557002384498.jpeg)

3.  Выберите версию mariadb (например, **mariadb103**) и запустите установку, выполнив команду:

```
sudo pkg install mariadb103-server mariadb103-client
```

4.  Чтобы при перезагрузке операционной системы сервис mariadb запускался автоматически, выполните команду:

```
sudo sysrc mysql_enable="yes"
```

5.  Запустите mariadb, выполнив команду:

```
sudo service mysql-server start
```

6.  Для изменения конфигурации сервера mariadb используйте команду:

```
sudo mysql_secure_installation
```

Данная команда запускает сценарий повышения безопасности сервера СУБД mariadb. Для настройки безопасности:

- Укажите пароль для учетной записи root.

**Внимание**

Рекомендуется указывать надежный пароль, который содержит не менее 8 символов, включающих по крайней мере одну заглавную букву, одну строчную букву, одну цифру и один специальный символ.

Пользователь root в данном случае относится исключительно к СУБД MySQL и не является учетной записью ОС CentOS.

- При необходимости удалите анонимные (anonymous) учетные записи, которые создаются при установке СУБД maridb:
  - Ответьте Y(es) для удаления анонимных учетных записей.
  - Ответьте N(o), если удаление анонимных учетных записей не требуется.

Данные учетные записи предназначены только для тестирования БД и в большинстве случаев могут быть удалены.

- При необходимости запретите предоставление удаленного доступа к базам СУБД MySQL для учетной записи root:
  - Ответьте Y(es) для отключения возможности удаленного доступа.
  - Ответьте N(o), для разрешения удаленного доступа.
- При необходимости удалите тестовую базу (Test):
  - Ответьте Y(es) для удаления базы Test.
  - Ответьте N(o), если удаление базы Test не требуется.

Данная база создается при установке сервера СУБД MySQL и предназначена для тестирования. Удаление базы Test не влияет на работу системы.

- В ответ на запрос на внесение изменений в СУБД MySQL и перезагрузку привилегий доступа к таблицам:
  - Ответьте Y(es) для внесения изменений и перезагрузки.
  - Ответьте N(o), если внесение изменений и перезагрузка не требуются.

## Установка PHP

Для установки PHP:

1.  Откройте окно терминала.
2.  Проверьте доступные версии PHP, выполнив команду:

```
ls /usr/ports/lang/ | grep php
```

![](./assets/1557002843363-1557002843363.jpeg)

3.  Для отображения всех доступных утилит PHP используйте команду:

```
pkg search -o php
```

4.  Установите PHP и дополнительные утилиты, выполнив команду:

```
sudo pkg install php56 mod_php56 php56-mbstring php56-mcrypt php56-zlib php56-curl php56-gd php56-json php56-mysqli
```

По завершении установки отобразится справочная информация, содержащая конфигурацию сервера Apache, например:

**![](./assets/1557002984407-1557002984407.jpeg)**

5.  Создайте файл php.conf, выполнив команду:

```
sudo ee /usr/local/etc/apache24/Includes/php.conf 
```

6.  В файл php.conf добавьте следующие строки:

```
<IfModule dir_module>
    DirectoryIndex index.php index.html
    <FilesMatch "\.php$">
        SetHandler application/x-httpd-php
    </FilesMatch>
    <FilesMatch "\.phps$">
        SetHandler application/x-httpd-php-source
    </FilesMatch>
</IfModule>
```

и сохраните внесенные изменения.

7.  Перезагрузите веб-сервер Apache, выполнив команду:

```
sudo service apache24 restart
```

8.  Убедитесь, что веб-сервер Apache корректно отображает скрипты PHP. Для этого:

- создайте файл info.php, выполнив команду:

```
sudo ee /usr/local/www/apache24/data/info.php

```

- в файл info.php поместите текст:

```
<?php
    phpinfo();
?>
```

- сохраните внесенные изменения и завершите редактирование;
- в адресной строке браузера к адресу веб-сервера добавьте строку:

```
/info.php
```

В результате должна отобразиться примерно следующая страница:

**![](./assets/1557003200841-1557003200841.jpeg)**

**Внимание**

В целях безопасности после проверки системы рекомендуется удалить файл info.php, выполнив команду:

```
sudo rm /usr/local/www/apache24/data/info.php

```

**Обратная связь**

Возникли проблемы или остались вопросы? [Напишите нам, мы будем рады вам помочь](https://mcs.mail.ru/help/contact-us).
