Для защиты соединений между клиентом и сервером PostgreSQL применяется протокол TLS (Transport Layer Security), который шифрует передаваемые данные, предотвращая перехват и несанкционированный доступ.

Для оптимизации подключений используется PgBouncer. Он управляет пулом соединений, повторно используя их и уменьшая количество активных подключений к PostgreSQL. Это снижает нагрузку на сервер, ускоряет выполнение запросов и предотвращает перегрузку ресурсов при большом количестве клиентов.

Данная инструкция поможет:

- настроить защищенное соединение для подключения к серверу PostgreSQL;
- запустить на сервере PostgreSQL расширение PgBouncer для оптимизации подключений;
- скорректировать запрос к БД PostgreSQL на клиенте;
- подключить расширение балансировщика PgBouncer.

## Подготовительные шаги

1. [Создайте](/ru/dbs/dbaas/instructions/create) инстанс БД Postgresql, если это не было сделано ранее.
1. Убедитесь, что инстанс баз данных запущен.

## 1. Настройте защищенное соединение на сервере PostgreSQL

1. В [личном кабинете VK Cloud](https://msk.cloud.vk.com/app) перейдите в раздел **Базы данных → Инстансы баз данных**.
1. Нажмите на имя инстанса. 
1. Перейдите на вкладку **Параметры баз данных → Добавить параметр**
1. В списке выберите параметр `ssl`, задайте значение для параметра `on`.
1. Нажмите кнопку **Сохранить** и подтвердите действие.

   После этого инстанс базы данных перезагрузится.


## 2. (Опционально) Подключите расширение балансировщика PgBouncer

1. Перейдите на вкладку **Расширения → Добавить**.
1. В выпадающем списке расширений выберите **pooler**.
1. Задайте основные [параметры](/ru/dbs/dbaas/extensions/postgresql#pgbouncer) расширения.
    
    * **pool_mode**: выберите режим управления соединениями или оставьте значение по умолчанию.
    * **max_client_conn**: задайте ограничение числа клиентских подключений для предотвращения перегрузки балансировщика или оставьте значение по умолчанию.
    * **listen_port**: укажите порт для входящих подключений или оставьте значение по умолчанию.


1. Нажмите кнопку **Сохранить**.

    Дождитесь процесса обновления параметра расширения.

## 3. Проверьте возможность подключения к инстансу Postgresql по защищенному соединению 

[Подключитесь](/ru/dbs/dbaas/connect#postgresql) к БД Postgresql, указав в запросе для параметра `sslmode` значение `require`.

## Удалите неиспользуемые ресурсы

Если инстанс базы данных вам больше не нужен, [удалите](/ru/dbs/dbaas/instructions/manage-instance/postgresql#udalenie_instansa_bd_ili_ego_hostov) его.