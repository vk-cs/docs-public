<warn>

Изменение созданных виртуальных ресурсов (ВМ, балансировщиков, инстансов БД) вне сервиса может привести к неработоспособности отдельных рабочих столов или всего пула в целом.

</warn>

## Подготовительные шаги

1. Убедитесь, что [подключение к сервису](../../config/) настроено.
1. (Опционально) Если хотите использовать для создания ВМ пула собственный образ, подготовьте его:

      <details>
       <summary>Требования и рекомендации для собственных образов рабочих столов</summary>

      - На образе должна быть установлена операционная система Windows или Astra Linux «Орел». Чтобы использовать другие операционные системы, обратитесь в [техническую поддержку](/ru/contacts).
      - На образе должны быть установлены гостевой [агент QEMU](https://pve.proxmox.com/wiki/Qemu-guest-agent) и пакет [cloud-init](https://www.ibm.com/docs/ru/powervc-cloud/2.0.0?topic=init-installing-configuring-cloud-linux).
      - На образ с ОС Astra Linux можно не устанавливать дополнительное ПО для поддержки протокола RDP и службы каталогов AD.
      - Рекомендуется установить на образ компоненты [программного продукта Termidesk]( https://termidesk.ru/), который позволяет ускорить подключение к рабочим столам пула.
  
        <tabs>
        <tablist>
        <tab>Windows</tab>
        <tab>Astra Linux</tab>
        </tablist>
        <tabpanel>

        Выполните команды в приложении Windows PowerShell:

        ```shell
        Invoke-WebRequest -Uri https://repos.termidesk.ru/windows/windows_x86_64/termidesk-agent_3.3.0.22287_x64.msi -OutFile $env:TEMP\termidesk-agent.msi
        Start-Process msiexec -ArgumentList "/i `"$env:TEMP\termidesk-agent.msi`" /qn" -Wait -NoNewWindow
        Remove-Item $env:TEMP\termidesk-agent.msi
        ```

        </tabpanel>
        <tabpanel>

        Выполните команды в терминале:

        ```shell
        apt update && apt install -y curl lsb-release spice-vdagent xserver-xorg-video-qxl xrdp
        echo "deb https://repos.termidesk.ru/astra $(lsb_release -cs) non-free" > /etc/apt/sources.list.d/termidesk.list
        curl https://repos.termidesk.ru/astra/GPG-KEY-PUBLIC | apt-key add -
        apt update && apt install -y 'python3-termidesk-agent=3.*' termidesk-pcsc-vscard termidesk-video-agent astra-ad-sssd-client
        ```

        </tabpanel>
        </tabs>

      </details>

1. Запустите мастер создания пула:

   1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
   1. Перейдите в раздел **Облачные рабочие столы** → **Пулы рабочих столов**.
   1. Нажмите кнопку **Добавить**.

   Откроется мастер создания нового пула.

## 1. Настройте конфигурацию пула

1. Задайте конфигурацию пула:

    - **Имя пула**: задайте имя, уникальное внутри проекта. Требования к полю: от 3 до 128 символов, допустимы только латинские буквы, символы `-`, `_`, пробелы и цифры.
    - **Тип пула**: выберите один из вариантов:

        - **Сессионный** — в таком пуле пользователю при подключении рабочий стол назначается автоматически. Используйте сессионный пул, если нужно развернуть большое количество столов одинаковой конфигурации с одним и тем же набором ПО. В сессионном пуле предусмотрен горячий резерв столов.
        - **Персонализированный** — в таком пуле администратор назначает рабочие столы конкретным пользователям. Подходит для развертывания рабочих столов с индивидуальной конфигурацией под отдельных пользователей. Этот тип пула используется чаще всего.

    - **Описание**: описание пула, до 250 символов.
    - **Группа пользователей**: укажите группу пользователей каталога AD или LDAP. Для пользователей этой группы будут назначаться рабочие столы из пула. Требования к полю: от 3 до 100 символов, допустимы только латинские буквы, символы `-`, `_`, `.`, цифры.
    - **Маска именования**: суффикс, с которого будут начинаться имена рабочих столов в этом пуле. Требования к маске: от 3 до 15 символов, допустимы только латинские буквы в нижнем регистре и символ `-` на конце.
    - **Мин. кол-во рабочих столов** — определяет, сколько рабочих столов будет развернуто сразу после создания пула. По умолчанию — `0`.

      Этот параметр не может превышать значение параметра **Макс. кол-во рабочих столов**.

    - **Макс. кол-во рабочих столов** — определяет, сколько столов в пуле могут одновременно использоваться.

      Параметр ограничен значением инкремента в параметре **Маска именования и ее инкремент**. Например, при инкременте `3` максимальное значение параметра — `999`.

    - **Горячий резерв** — доступен только для сессионных пулов. Столы из горячего резерва становятся доступными только в момент подключения пользователя и при завершении пользовательской сессии возвращаются в резерв.

      В горячем резерве не будет доступных рабочих столов, если выбрано значение `0` или параметры **Мин. кол-во рабочих столов** и **Макс. кол-во рабочих столов** совпадают.

    - **Таймаут неактивности польз.**: время, через которое пользователь будет отсоединен от рабочего стола при отсутствии активности в рабочем столе. Таймаут работает для протоколов RDP и RX.

      При значении `0` пользовательская сессия не будет прерываться по таймауту.

1. Нажмите кнопку **Следующий шаг**.

## 2. Настройте виртуальные машины пула

1. Задайте настройки виртуальных машин, на которых будут создаваться рабочие столы пула:

    - **Тип инстанса**: выберите тип ВМ из списка типов, доступных в проекте.
    - **Размер диска**: укажите размер диска в ГБ. Значение не может быть меньше размера образа ОС.
    - **Тип диска**: выберите одно из значений — `HDD`, `SSD` или `High-IOPS SSD`.
    - **Образ**: выберите образ для создания ВМ из списка доступных образов. При необходимости нажмите кнопку **Загрузить свой образ** и загрузите [ранее подготовленный](../add#podgotovitelnye_shagi) образ, следуя [инструкции по импорту](/ru/base/iaas/instructions/vm-images/vm-images-manage#import_obraza).

      <info>

      Создать пул невозможно до завершения загрузки образа.

      </info>

    - **Настройка группы безопасности <наименование пула>**: укажите группы безопасности для ВМ. Если не указать значение, группа не будет назначена.

1. Нажмите кнопку **Следующий шаг**.

## 3. Настройте периферию

1. Выберите, какие [периферийные устройства](../../../concepts/overview#dostupnye_periferiynye_ustroystva) будут доступны пользователям рабочих столов пула.
1. Нажмите кнопку **Создать пул**.

   Пул будет создан в течение часа.

При успешном создании пула откроется список созданных пулов.
