Резервное копирование — это не просто страховка от потери данных, но и ключевой элемент стратегии непрерывности бизнеса.

Правильные настройки резервного копирования помогают:

- гарантированно восстановить данные в любой момент;
- оптимизировать затраты на хранение данных за счет гибких стратегий;
- автоматизировать процессы, исключив человеческий фактор.

Лучшие практики по настройке резервного копирования предполагают подход в 4 этапа:

1. [Определение критичности данных](/ru/storage/backups/concepts/best-practices#categorization).
2. [Настройка резервного копирования для критичных данных](/ru/storage/backups/concepts/best-practices#critical_data).
3. [Настройка резервного копирования для некритичных данных](/ru/storage/backups/concepts/best-practices#noncritical_data).
4. [Тестирование восстановления данных](/ru/storage/backups/concepts/best-practices#recovery_test).

## {heading(1. Определение критичности данных)[id=categorization]}

Перед настройкой резервного копирования разделите данные на две категории:

- Критичные — данные, потеря которых приведет к нарушениям работы бизнеса. К таким данным можно отнести, например, базы данных учетных систем, настройки инфраструктуры, финансовые транзакции.
   Определите для таких данных:

  - *RPO* (Recovery Point Objective) — максимально допустимый уровень потерь (например, данные за последние 15 минут).
  - *RTO* (Recovery Time Objective) — время, за которое данные должны быть восстановлены (например, 1 час).

- Некритичные — данные, которые можно восстановить без использования резервных копий или которые не оказывают значительного влияния на работу бизнеса. К таким данным можно отнести, например, временные файлы, логи, тестовые среды.

Разделение данных на критичные и некритичные позволяет сэкономить ресурсы за счет разных настроек резервного копирования и хранения копий для более ценных и менее ценных данных.

## {heading(2. Настройка резервного копирования для критичных данных)[id=critical_data]}

{note:info}

Подробно работа с планами резервного копирования и управление резервными копиями описаны в [пошаговых инструкциях](/ru/storage/backups/instructions).

{/note}

Для критичных данных важны максимальная сохранность и возможность восстановить такие данные на конкретный момент времени, поэтому используйте и полные, и инкрементальные резервные копии, а также стратегию долгосрочного хранения данных.

Для максимальной защиты критичных данных используйте:

- Автоматические копии:

  - Полные резервные копии — создаются раз в неделю или чаще при необходимости.
  - Инкрементальные копии — создаются ежедневно. Инкрементальные копии содержат только те файлы, которые изменились с момента последнего резервного копирования. Это экономит место и позволяет восстановить данные на нужный момент времени.

- *GFS-стратегию* (Grandfather-Father-Son) для долгосрочного хранения данных. Рекомендуемые сроки хранения:

  - Еженедельные копии — 4 недели.
  - Месячные копии — 12 месяцев.
  - Годовые копии — 5 лет (например, для проверки на соответствие требованиям).

### Особенности резервного копирования баз данных

Данные в БД постоянно обновляются, поэтому важно восстановить их на конкретный момент времени. Для этого используется восстановление не только файлов БД, но и последних транзакций.

Для СУБД (PostgreSQL, MySQL и др.) важны:

- *Point-in-Time Recovery* (PITR) — механизм восстановления базы данных на конкретный момент времени с точностью до секунды. Доступен и особенно важен для PostgreSQL, где используется журнал транзакций (WAL).
- Хранение журналов транзакций — обязательное условие для PITR.
- Частота копирования — для высоконагруженных БД создавайте инкрементальные копии каждые 3 часа.

[Создайте](/ru/storage/backups/instructions/create-backup-plan#create_db_backup_plan) для СУБД план с инкрементальным копированием и хранением по [стратегии GFS](/ru/storage/backups/concepts/retention-policy/gfs-backup). [Создайте план](/ru/storage/backups/instructions/point-in-time-recovery-pitr) PITR для PostgreSQL, чтобы минимизировать потери и ускорить восстановление.

## {heading(3. Настройка резервного копирования для некритичных данных)[id=noncritical_data]}

{note:info}

Подробно работа с планами резервного копирования и управление резервными копиями описаны в [пошаговых инструкциях](/ru/storage/backups/instructions).

{/note}

Для некритичных данных можно использовать более экономные стратегии резервного копирования и хранения копий, немного снизив надежность и скорость восстановления данных из резервной копии.

Для экономии ресурсов:

- Используйте стратегию [ограничения количества резервных копий](/ru/storage/backups/concepts/retention-policy/forward-incremental) — при превышении лимита старые копии будут удаляться автоматически. Оптимально использовать не менее 3 полных копий единовременно.
- Используйте инкрементальные копии — они занимают меньше места, но восстановление данных из такой копии будет более долгим.

[Создайте](/ru/storage/backups/instructions/create-backup-plan) план с инкрементальным копированием и при создании ограничьте количество полных копий, чтобы сократить затраты, максимально сохранив данные.

## {heading(4. Тестирование восстановления данных)[id=recovery_test]}

Резервные копии бесполезны, если их нельзя восстановить. Раз в квартал тестируйте [восстановление](/ru/storage/backups/instructions/restore-from-backup) критичных данных. Восстановление некритичных данных проверяйте по необходимости — в случаях, когда у вас возникли сомнения в успешности резервного копирования.

При восстановлении проверяйте:

- полноту данных;
- соответствие времени восстановления вашему RTO;
- работоспособность сервисов после восстановления.

## {heading(Сравнение рекомендаций для разных категорий данных)[id=comparison]}

[cols="1,2,2", options="header"]
|===
| Параметр
| Критичные данные
| Некритичные данные

| Тип копий
| Обязательно и полные, и инкрементальные
| Обязательно полные, инкрементальные — при необходимости

| Стратегия хранения
| GFS (4/12/5)
| Ограничение полных копий: от 3 полных копий единовременно

| PITR
| Включен для PostgreSQL
| ![](/ru/assets/no.svg "inline")

| Частота тестирования
| Каждые 3 месяца
| По необходимости

|===

Настроив резервное копирование по этим правилам, вы получите надежную защиту данных без переплат. Все настройки можно [изменить](/ru/storage/backups/instructions/manage-backup-plan#edit_backup_plan) в любое время в личном кабинете VK Cloud.
