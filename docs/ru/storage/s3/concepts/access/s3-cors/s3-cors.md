CORS (Cross-Origin Resource Sharing) — механизм, который позволяет задать правила обработки кросс-доменных запросов. По умолчанию браузеры блокируют доступ, если веб-приложение, размещенное в одном домене, вызывает API для источника, расположенного в другом домене. Это делается, чтобы предотвратить несанкционированный доступ к ресурсам. Благодаря поддержке CORS в сервисе VK Object Storage вы можете обойти это ограничение и выборочно разрешать доступ к вашим бакетам для клиентских веб-приложений, размещенных в других доменах.

Подключить механизм СORS для бакета можно двумя способами:

- [Задать](../../../instructions/access-management/cors#add_rule_cors) в личном кабинете каждое правило CORS по отдельности.
- [Загрузить XML-конфигурацию](/ru/tools-for-using-services/api/api-spec/s3-rest-api/cors-api#set_bucket_cors) всех правил CORS одновременно с помощью API.

{note:warn}
При использовании второго способа существующая конфигурация CORS перезаписывается. Это значит, что правила, добавленные ранее в личном кабинете, будут потеряны.
{/note}

Для каждого бакета настраиваются свои правила CORS, в которых указываются следующие параметры:

- `AllowedOrigins` — домены, с которых разрешены запросы к бакету.
- `AllowedMethods` — HTTP-методы, разрешенные в запросах.
- (Опционально) `MaxAgeSeconds` — время в секундах, в течение которого браузер пользователя может сохранять в кэше результаты [предварительного запроса](#cors_request).
- (Опционально) `AllowedHeaders` — заголовки, разрешенные в запросах.
- (Опционально) `ExposeHeaders` — заголовки, которые будут доступны пользователю в ответе на запрос.

## {heading(Особенности CORS-запросов)[id=cors_request]}

CORS-запрос — HTTP-запрос, содержащий заголовок `Origin`. В этом заголовке указывается домен инициатора запроса. Если CORS-запрос может привести к изменению данных, он рассматривается как небезопасный и выполняется в два этапа:

- Предварительный запрос (preflight request), который проверяет ограничения CORS для запрашиваемого ресурса.
- Основной запрос, направленный на получение ресурса.

Предварительный запрос использует метод `OPTIONS` и содержит параметры основного запроса: заголовки, HTTP-метод и домен (`Origin`).

Когда VK Object Storage получает предварительный запрос от браузера, он анализирует конфигурацию CORS для запрашиваемого бакета и может принять или отклонить запрос. Чтобы запрос был принят, должны выполняться следующие условия:

- Домен, указанный в заголовке `Origin`, должен быть включен в список `AllowedOrigins` в конфигурации CORS бакета.

- Метод HTTP, указанный в запросе, должен быть включен в список `AllowedMethods` в конфигурации CORS бакета.

- Заголовки, указанные в запросе, должны соответствовать заголовкам в списке `AllowedHeaders` в конфигурации CORS бакета.

Если предварительный запрос отклоняется, браузер блокирует отправку основного запроса.

Если предварительный запрос принимается, VK Object Storage возвращает информацию о конфигурации CORS бакета. Браузер может хранить эту информацию в кеше в течение периода, указанного в параметре `MaxAgeSeconds` конфигурации CORS.

Кеширование ответов на предварительный запрос может значительно улучшить производительность работы с VK Object Storage, так как уменьшает количество необходимых запросов. При повторном запросе к тому же бакету предварительный запрос не потребуется, если данные о конфигурации CORS бакета уже есть в кеше браузера.
