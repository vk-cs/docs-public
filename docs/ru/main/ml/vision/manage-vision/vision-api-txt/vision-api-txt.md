HOST: https://smarty.mail.ru

ENDPOINT: /api/v1/text/recognize

Данный метод позволяет распознавать текст на изображении.

## Запрос

Авторизационные данные передаются в строке запроса:

| **Параметр**     | **Тип**  | **Значение**                                 |
| ---------------- | -------- | -------------------------------------------- |
| `oauth_token`    | `string` | OAuth2 access token **(required non-empty)** |
| `oauth_provider` | `string` | провайдер OAuth2 **(required non-empty)**    |

Поддерживаемые провайдеры OAuth2:

| **Провайдер** | **Значение oauth_provider** | **Получение токена**                                                                                     | **Проекты**               |
| ------------- | --------------------------- | -------------------------------------------------------------------------------------------------------- | ------------------------- |
| VK Cloud           | mcs                         | [https://mcs.mail.ru/help/vision-auth/vision-token](https://mcs.mail.ru/help/vision-auth/vision-token)   | все клиенты VK Cloud           |

Параметры запроса передаются в формате `JSON` в теле запроса с `name="meta":`

| **Параметр** | **Тип**        | **Значение**                                                 |
| ------------ | -------------- | ------------------------------------------------------------ |
| images       | `[]image_meta` | метаданные передаваемых изображений **(required non-empty)** |
| mode         | `string`       | параметр-флаг: выдавать ли детализированный ответ, если "detailed", то детализированный (к ответу добавляются координаты bounding box текста и confidence), **(optional)** |

image_meta

| **Параметр** | **Тип** | **Значение** |
| ------------ | ------- | -------------|
| name         | string  | имена файлов для сопоставления файлов в запросе и ответе **(required non-empty)** |

Изображения передаются в теле запроса, значения поля `name` должны соответствовать переданным в `images.`

Максимальное количество изображений в одном запросе равняется 100. Максимальный размер каждого изображения не должен превышать 4МБ.

Пример запроса:

```
POST /api/v1/text/recognize?oauth_provider=mcs&oauth_token=123 HTTP/1.1

Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryfCqTBHeLZlsicvMp
 
------WebKitFormBoundaryfCqTBHeLZlsicvMp
Content-Disposition: form-data; name="file_0"; filename=""
Content-Type: image/jpeg
 
000000000000000000000000000
000000000000000000000000000
000000000000000000000000000
------WebKitFormBoundaryfCqTBHeLZlsicvMp
Content-Disposition: form-data; name="file_1"; filename=""
Content-Type: image/jpeg
 
111111111111111111111111111
111111111111111111111111111
111111111111111111111111111
------WebKitFormBoundaryfCqTBHeLZlsicvMp
Content-Disposition: form-data; name="meta"
 
{"images":[{"name":"file_0"},{"name":"file_1"}]}
------WebKitFormBoundaryfCqTBHeLZlsicvMp--
```

## Ответ

| **Параметр** | **Тип**    | **Значение**                                              |
| ------------ | --------   | --------------------------------------------------------- |
| `status`     | `int`      | 200 в случае успешного взаимодействия с серверами Vision  |
| `body`       | `response` | тело ответа                                               |

### `response`

| **Параметр** | **Тип**    | **Значение**                     |
| ------------ | ---------- | -------------------------------- |
| objects      | `[]object` | массив ответов для каждого файла |

### `object`

| **Параметр** | **Тип**  | **Значение**                                          |
| ------------ | -------- | ----------------------------------------------------- |
| `status`     | `enum`   | результат выполнения                                  |
| `error`      | `string` | текстовое описание ошибки **(optional)**              |
| `name`       | `string` | имя файла для сопоставления файлов в запросе и ответе |
| `text`       | `string` | распознанный текст                                    |
| `results`    | `[]line` | если проставлен "mode":"detailed" - массив строк ответов по странице (текст, bounding box, confidence) |

### `status`

| **Параметр** | **Значение**        |
| ------------ | ------------------- |
| 0            | успешно             |
| 1            | перманентная ошибка |
| 2            | временная ошибка    |

### `line`

| **Параметр** | **Тип**        | **Значение**             |
| ------------ | ------------------- | ------------------- |
| `line_prob`    | `float32`   | уверенность распознавания строки          |
| `line_coord`   | `[]float32` | координаты строки - x1,y1, x2, y2 - левый верхний и правый нижний точки охватывающего прямоугольника                                           |
| `words`        | `[]word`    | массив распознанных слов ответов в строке |

### `word`

| **Параметр** | **Тип**        | **Значение**                                        |
| ------------ | ------------------- | ---------------------------------------------- |
| `prob`        | `float32`   | уверенность распознавания слова                           |
| `coord`       | `[]float32` | координаты слова - x1,y1, x2, y2 - левый верхний и правый нижний точки охватывающего прямоугольника                                                          |
| `text`        | `string`    | массив распознанных слов ответов в строке                 |
| `lang_prob`   | `float32`   | уверенность распознавания языка                           |
| `lang`        | `string`    | eng/rus/unknown. unknown когда не содержит букв алфавита  |

Пример ответа:

При отсутствии флага  "mode":"detailed":
```
{
    "status":200,
    "body":
    {        
     "objects":[
     {
         "status":0,
         "name":"file_0",
         "text":"some text"
     }
}
```

При наличии флага  "mode":"detailed":
```
{
    "status":200,
    "body":
    {        
     "objects":[
     {
         "status":0,
         "name":"file_0",
         "results":[{
               "words":[{"coord":[201,159,291,204],"prob":0.9952,"text":"you!","lang_prob":0.9998,"lang":"eng"}, ...],
               "line_prob":0.8123,
               "line_coord":[18,155,291,201]
                     }, ...]
     }
}
```

Пример ответа, когда не удалось выполнить запрос:

```
{
    "status":500,
    "body":"Internal Server Error",
    "htmlencoded":false,
    "last_modified":0
}
```
