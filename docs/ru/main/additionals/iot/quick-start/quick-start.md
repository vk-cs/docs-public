Быстрый старт поможет вам начать работу с сервисом и познакомиться с его возможностями.

Пройдя все шаги быстрого старта, вы:

1. Создадите драйвер и шаблон устройства.
1. Создадите новое устройство в структуре.
1. Создадите шаблон агента и сам агент.
1. Авторизуете агент для работы с созданным устройством.
1. Подключите эмулятор устройства к IoT Platform.
1. Настроите экспорт данных в объектное хранилище VK Cloud.

## 1. Подготовительные шаги

1. [Зарегистрируйтесь](../registration) в IoT Platform. Убедитесь, что у вас есть доступ к личному кабинету IoT.
1. [Скачайте эмулятор](https://github.com/vk-cs/iot-emulators/releases) устройства IoT для вашей ОС. Распакуйте скачанный архив при необходимости.
1. Настройте объектное хранилище:

    1. [Создайте](/ru/base/s3/quick-start/create-bucket) бакет `s3_exporter`.
    1. [Настройте](/ru/base/s3/access-management/s3-account) аккаунт S3.
    1. Сохраните сгенерированные `Access Key ID` и `Secret Key` для созданного аккаунта.

## 2. Создайте драйвер эмулятора

1. Перейдите в раздел **Драйверы** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите кнопку **Добавить драйвер**.
1. В открывшейся форме укажите значения:

   - **Название**: `Драйвер эмулятора`.
   - **Идентификатор**: `emulatorDriver`.
   - **Протокол**: `embedded`.

1. Нажмите кнопку **Следующий шаг**.
1. Нажмите кнопку **Добавить параметр** в разделе **Параметры События**. Этот параметр будет контролировать частоту опроса сенсоров агентом у устройства. В открывшейся форме укажите значения и нажмите кнопку **Сохранить**:

   - **Название**: `event_scrape_interval`.
   - **Тип значения**: `duration`.
   - **Обязательный параметр**: `Да`.
   - **Значение по умолчанию**: `30s`.

1. Нажмите кнопку **Добавить параметр** в разделе **Параметры Состояния**. Этот параметр будет контролировать частоту опроса переключателей агентом у устройства. В открывшейся форме укажите значения и нажмите кнопку **Сохранить**:

   - **Название**: `state_scrape_interval`.
   - **Тип значения**: `duration`.
   - **Обязательный параметр**: `Да`.
   - **Значение по умолчанию**: `30s`.

1. Нажмите кнопку **Сохранить** внизу страницы.

## 3. Создайте шаблон устройства

1. Перейдите в раздел **Шаблоны устройств** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите кнопку **Добавить шаблон**.
1. Укажите в полях формы значения:

   - **Название шаблона**: `Шаблон эмулятора`.
   - **Идентификатор**: `emulatorTemplate`.

1. Нажмите кнопку **Следующий шаг**.
1. Выберите в поле **Драйвер** вариант `Драйвер эмулятора`.
1. Нажмите кнопку **Следующий шаг**.
1. Пропустите добавление параметров устройства и нажмите кнопку **Следующий шаг**.

   <info>

   Откроется страница **Дерево устройства**. В рамках быстрого старта будут использованы датчики:

   - сенсор температуры;
   - сенсор влажности;
   - переключатель освещения в помещении.

   </info>

1. Откройте меню справа от строки **Корневой узел шаблона** и выберите **Добавить датчик**.
1. В открывшейся форме заполните поля:

   - **Название**: `Сенсор температуры`.
   - **Идентификатор**: `temperature`.
   - **Тип датчика**: `Событие`.
   - **Ед. измерения**: `С`.
   - **Тип значения**: `float`.
   - **Автосохранение в оперативное хранилище**: отметить опцию.
   - **Автосохранение в долговременное хранилище**: отметить опцию.
   - **Родительский тег**: `Корневой узел шаблона`.
   - **Параметры драйвера**: оставить без изменений.

    Нажмите кнопку **Сохранить**.

1. Повторите шаг по созданию датчика для сенсора влажности, указав параметры:

    - **Название**: `Сенсор влажности`.
    - **Идентификатор**: `humidity`.
    - **Тип датчика**: `Событие`.
    - **Ед. измерения**: `%`.
    - **Тип значения**: `float`.
    - **Автосохранение в оперативное хранилище**: отметить опцию.
    - **Автосохранение в долговременное хранилище**: отметить опцию.
    - **Родительский тег**: `Корневой узел шаблона`.
    - **Параметры драйвера**: оставить без изменений.

    Нажмите кнопку **Сохранить**.

1. Повторите шаг по созданию датчика для переключателя освещения, указав параметры:

    - **Название**: `Переключатель освещения в помещении`.
    - **Идентификатор**: `light`.
    - **Тип датчика**: `Состояние`.
    - **Ед. измерения**: не заполнять.
    - **Тип значения**: `boolean`.
    - **Автосохранение в цифровой двойник**: отметить опцию.
    - **Родительский тег**: Корневой узел шаблона.
    - **Параметры драйвера**: оставить без изменений.

    Нажмите кнопку **Сохранить**.

1. Нажмите кнопку **Сохранить** под списком.

## 4. Создайте экземпляр устройства

1. Перейдите в раздел **Устройства** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите кнопку **Добавить устройство**.
1. В появившейся форме заполните поля:

   - **Название**: `Эмулятор`.
   - **Идентификатор**: `emulator`.
   - **Шаблон устройства**: `Шаблон эмулятора`.
   - **Агент**: `Без агента`.

1. Нажмите кнопку **Следующий шаг**.
1. В появившейся форме заполните поля:

   - **Название тега**: `Эмулятор`.
   - **Идентификатор тега**: `emulator`.
   - **Родительский узел**: `Корень проекта`.

1. Нажмите кнопку **Следующий шаг**.
1. Повторите предыдущий шаг.
1. Нажмите кнопку **Сохранить**.

## 5. Создайте шаблон агента

1. Перейдите в раздел **Шаблоны агентов** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите кнопку **Добавить шаблон**.
1. В появившейся форме заполните поля:

    - **Название**: `Шаблон агента эмулятора`.
    - **Идентификатор**: `agentTemplate`.
    - **Поддерживаемые драйверы**: `Драйвер эмулятора`.

1. Нажмите кнопку **Добавить**.

## 6. Создайте и настройте агент

1. Перейдите в раздел **Агенты** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите кнопку **Добавить агент**.
1. В появившейся форме заполните поля:

   - **Название**: `Агент для эмулятора`.
   - **Идентификатор**: `emulatorAgent`.
   - **Шаблон**: `Шаблон агента эмулятора`.

1. Нажмите кнопку **Сохранить**.
1. Перейдите в раздел **Устройства**.
1. Нажмите на устройство **Эмулятор** в общем списке.
1. Нажмите кнопку **Редактировать**.
1. В поле **Агент** выберите вариант `Агент для эмулятора`.
1. Нажмите кнопку **Следующий шаг**.
1. Нажмите кнопку **Сохранить**.

## 7. Подключите устройство

1. Перейдите в раздел **Агенты** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите на **Агент для эмулятора** в общем списке.
1. Перейдите на вкладку **Авторизационные данные**.
1. Скопируйте логин и пароль из одноименных полей.
1. Откройте терминал или командную строку вашей ОС.
1. Перейдите в директорию с распакованным архивом с эмулятором.
1. Выполните команду:

    <tabs>
    <tablist>
    <tab>MacOS</tab>
    <tab>Linux</tab>
    <tab>Windows</tab>
    </tablist>
    <tabpanel>

    ```bash
    ./bin/darwin_amd64/starting_guide -login <скопированный логин агента> -password <пароль агента>
    ```

    </tabpanel>
    <tabpanel>

    ```bash
    ./bin/linux_amd64/starting_guide -login <скопированный логин агента> -password <пароль агента>
    ```

    </tabpanel>
    <tabpanel>

    ```bash
    bin\windows_amd64\starting_guide.exe -login <скопированный логин агента> -password <пароль агента>
    ```

    </tabpanel>
    </tabs>

1. Убедитесь, что эмулятор начал отправлять данные — должны появится строки вида:

    ```bash
    2023-02-13T12:23:21.152+0300    INFO    Bootstrapping emulator
    2023-02-13T12:23:21.493+0300    INFO    Running emulator
    2023-02-13T12:23:51.750+0300    INFO    Sending light state value  {"value": true}
    2023-02-13T12:23:51.750+0300    INFO    Sending humidity value  {"value": 39.9125}
    2023-02-13T12:23:51.750+0300    INFO    Sending temperature value  {"value": 26.139}
    2023-02-13T12:24:21.758+0300    INFO    Sending humidity value  {"value": 39.9267}
    2023-02-13T12:24:21.758+0300    INFO    Sending temperature value  {"value": 26.111}
    2023-02-13T12:24:21.758+0300    INFO    Sending light state value  {"value": true}
    2023-02-13T12:24:51.750+0300    INFO    Sending light state value  {"value": false}
    2023-02-13T12:24:51.750+0300    INFO    Sending humidity value  {"value": 39.772}
    ```

## 8. Проверьте получение данных

1. Перейдите в раздел **Устройства** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите на устройство **Эмулятор** в общем списке.
1. Перейдите на вкладку **Структура устройства**.
1. Последовательно нажмите на каждую строку из структуры — откроется статистика по собранным данным от эмулятора устройства.

## 9. Настройте экспорт данных в объектное хранилище

В качестве S3-совместимого хранилища будет использовано S3-хранилище в облаке VK Cloud, а источника данных для экспорта – эмулятор.

### 9.1. Создайте экспортер

1. Перейдите в раздел **Экспортеры** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите кнопку **Добавить экспортер**.
1. На странице заполните поля:

    - **Идентификатор**: `s3`.
    - **Название**: `s3`.
    - **Описание**: `S3 экспортер`.
    - **Тип экспортера**: `s3`.

1. Нажмите кнопку **Следующий шаг**.
1. На странице заполните поля:

    - **CONNECTION_URL_STRING**: `hb.bizmrg.com`.
    - **BUCKET**: `s3_exporter`.
    - **REGION**: `ru-msk`.
    - **SSL**: `1`.
    - **ACCESS_KEY_ID**: значение `Access Key ID`, сгенерированное при создании аккаунта S3.
    - **SECRET_ACCESS_KEY**: значение `Secret Key`, сгенерированное при создании аккаунта S3.
    - **MAX_BULK_INSERT_SIZE**: `100`.
    - **PERIOD_BETWEEN_RETRIES**: `5s`.
    - **FORMAT**: `jsonl`.
    - **BULK_INSERT_TIMEOUT**: `1m`.

1. Нажмите кнопку **Сохранить**.

### 9.2. Создайте правило

1. Перейдите в раздел **Правила** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите кнопку **Добавить правило**.
1. На странице заполните поля:

    - **Название**: `Экспорт в S3`.
    - **Идентификатор**: `export_s3`.
    - **Тип правила**: `Реактивное`.
    - **Правило активно**: отметить опцию.

1. Нажмите кнопку **Следующий шаг**.
1. На странице заполните поля:

    - **Язык**: `Python`.
    - **Код правила**: вставьте код ниже.

    ```python
    from coiiot_sdk import exporters, context, user_logs

    logger = user_logs.get_logger()
    exporter = exporters.get_by_name("s3")
    ctx = context.current()

    logger.info("sending event into s3 storage")
    try:
        exporter.send({
            "tag": ctx.tag.full_name,
            "value": ctx.msg.value,
            "timestamp": ctx.msg.timestamp,
        })
    except Exception as e:
        logger.error("failed to send event into s3 storage")
    else:
        logger.info("successfully sent event into s3 storage")
    ```

1. Нажмите кнопку **Добавить**.

### 9.3. Назначьте правило на эмулятор и проверьте его работу

1. Перейдите в раздел **Устройства** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
1. Нажмите на устройство **Эмулятор** в общем списке.
1. Перейдите на вкладку **Структура устройства**.
1. Откройте меню справа от строки **Сенсор температуры** и выберите **Редактировать**.
1. В поле **Правила потоковой обработки** выберите правило `export_s3`.
1. Нажмите кнопку **Сохранить**.
1. Подождите не менее 5 минут. Перейдите в раздел **Логирование**.
1. Убедитесь, что появилась запись вида `[rule_name=export_s3], successfully sent event into s3 storage`.
1. В личном кабинете VK Cloud [откройте файлы бакета](https://mcs.mail.ru/app/services/storage/buckets/): убедитесь, что появился файл с данными IoT в формате `json`.

## Проконтролируйте использование ресурсов

1. Остановите эмулятор устройства: должна появиться запись вида `Got termination signal, closing app...`.
1. Отвяжите правило от эмулятора:

    1. Перейдите в раздел **Правила** [личного кабинета](https://iot.mcs.mail.ru/) IoT Platform.
    1. Нажмите на правило **Экспорт в S3** в общем списке.
    1. Нажмите кнопку **Редактировать**.
    1. Уберите флажок для поля **Правило активно**.
    1. Нажмите кнопку **Следующий шаг**.
    1. Нажмите кнопку **Сохранить**.

## Что дальше?

- [Познакомьтесь](../rules) с библиотекой SDK.
- [Настройте](../schedulers/add) расписание для измерения параметров устройств.
