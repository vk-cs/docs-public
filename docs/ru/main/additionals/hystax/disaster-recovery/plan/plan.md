План аварийного восстановления — это описание инфраструктуры и набор необходимых инструкций, используемых для воссоздания бизнес-приложения на целевом облаке VK Cloud в случае аварии. План аварийного восстановления создается заранее на основе декларативного описания инфраструктуры, тестируется и поддерживается в актуальном состоянии путем периодических обновлений и репликаций. Планы аварийного восстановления должны всегда поддерживаться в актуальном состоянии, так как может потребоваться дополнительное время для обновления плана после аварии.

## Установка агента аварийного восстановления

Первым делом необходимо установить агент аварийного восстановления. На главном экране личного кабинета пользователя Hystax Acura и перейдите к установке агента. Вам будут заданы вопросы об операционной системе реплицируемого хоста, а на последнем шаге вы получите ссылку для скачивания агента и инструкцию по установке. После успешной установки и запуска агента аварийного восстановления он подключится к инсталляции Hystax Acura.

На странице «Customer» этот хост появится в разделе «Machine Groups». Статус «Discovered» говорит, что этот хост обнаружен, но репликация еще не проводилась.

Теперь можно запустить репликацию хоста. Для этого нажмите на «...» и в выпадающем меню выберите пункт «Start Replication». Процесс аварийного восстановления может занять длительное время: это зависит от объема данных на диске и пропускной способности сети. При успешном завершении процесса репликации статус реплицируемого хоста отмечается как «Synced».

После репликации данных хостов можно выполнять миграцию самих хостов в целевое облако. Для этого нужно создать план аварийного восстановления, в котором будут указаны, какие хосты будут мигрировать.

## Создание плана аварийного восстановления

Теперь вы можете настроить параметры аварийного восстановления. Для этого нажмите «...» и в выпадающем меню выберите пункт «Edit Replication settings». Появится окно, в котором можно указать расписание аварийного восстановления и такие параметры как *Volume Type* и *Volume availability zone*. Укажите *Volume type* «GZ1» и нажмите «Save».

Чтобы создать план аварийного восстановления нажмите «Add DR plan». Перейдите во вкладку «Expert» и нажмите на «Generate DR plan from all machines». Будет сгенерирован план аварийного восстановления в виде документа в формате JSON, содержащий описание всех добавленных в личный кабинет хостов со значением параметров по умолчанию. В сгенерируемом плане необходимо заменить *flavor: m1.medium* на один из доступных флейворах:

- flavor: "Standard-4-8-80";
- flavor: "Advanced-8-16-120" (необходимо сделать запрос в техническую поддержку на добавление данного флейвора).

План аварийного восстановления следует скорректировать таким образом, чтобы он соответствовал вашим требованиям развертывания хостов, мигрирующих в целевой проект.

<details>
<summary>Пример плана аварийного восстановления</summary>

```JSON
{
  "subnets": {
    "subnet_0": {
      "name": "subnet_0",
      "cidr": "10.0.1.0/24",
      "subnet_id": "2aebd081-44a8-480f-xxxx-yyyyyyyyyyyy"
    }
  },
  "devices": {
    "ubuntu01": {
      "id": "ec09a435-3389-d19f-4cf4-zzzzzzzzzzz",
      "security_groups": [
        "default_all"
      ],
      "availability_zone": "MS1",
      "rank": 0,
      "flavor": "Standard-4-8-80",
      "ports": [
        {
          "name": "port_0",
          "ip": "10.0.1.23",
          "floating_ip": true,
          "subnet": "subnet_0"
        }
      ]
    },
    "centos01": {
      "id": "a40d5ef3-e244-dab5-9df0-aaaaaaaaaaaa",
      "security_groups": [
        "default_all"
      ],
      "availability_zone": "DP1",
      "rank": 0,
      "flavor": "Standard-4-8-80",
      "ports": [
        {
          "name": "port_0",
          "ip": "10.0.1.27",
          "floating_ip": true,
          "subnet": "subnet_0"
        }
      ]
    }
  }
}
```
</details>

В этом плане описываются два хоста, и подсеть, в которой эти хосты будут развернуты.

На верхнем уровне документа находятся два объекта:

- subnets – содержит описание подсетей целевого проекта, к которым будут подключены мигрирующие хосты.
- devices – содержит описание хостов, которые будут развернуты в целевом проекте. Можно указать нужный тип флейвора, группы безопасности хоста, ЦОД размещения, очередность запуска, а также переопределить подсеть и ip-адрес мигрирующего хоста.

Развернутое описание этих и других параметров плана аварийного восстановления можно найти в [официальной документации](https://docs.hystax.com/live-migration/migration_overview.html#migration-plan-syntax) Hystax Acura.

Далее укажите название плана аварийного восстановления и нажмите кнопку «Save».

После завершения создания и настройки плана аварийного восстановления, переходите к [запуску аварийного восстановления](/docs/ru/additionals/hystax/disaster-recovery/launch) защищаемой инфраструктуры.
