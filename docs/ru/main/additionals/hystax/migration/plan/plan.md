Перед тем как мигрировать свою инфраструктуру в VK Cloud необходимо:

- скачать и установить агент миграции;
- настроить план миграции (Migration plan), в котором указано указано какие хосты будут мигрировать.

## Установка агента миграции

Первым делом необходимо установить агент миграции на машину, которая в дальнейшем будет мигрировать. Существуют агенты миграции как для Windows, так и для Linux.

На главном экране личного кабинета пользователя Hystax Acura и перейдите к установке агента. Вам будут заданы вопросы об операционной системе реплицируемого хоста, а на последнем шаге вы получите ссылку для скачивания агента и инструкцию по установке. После успешной установки и запуска агента миграции он подключится к инсталляции Hystax Acura.

На странице «Customer» этот хост появится в разделе «Machine Groups». Статус «Discovered» говорит, что этот хост обнаружен, но репликация еще не проводилась.

Теперь можно запустить репликацию хоста. Для этого нажмите на «...» и в выпадающем меню выберите пункт «Start Replication». Процесс миграции может занять длительное время: это зависит от объема данных на диске и пропускной способности сети. При успешном завершении процесса репликации статус реплицируемого хоста отмечается как «Synced».

После репликации данных хостов можно выполнять миграцию самих хостов в целевое облако. Для этого нужно создать план миграции (Migration plan), в котором будут указаны, какие хосты будут мигрировать.

## Настройка плана миграции

Теперь вы можете настроить параметры миграции. Для этого нажмите «...» и в выпадающем меню выберите пункт «Edit Replication settings». Появится окно, в котором можно указать расписание миграции и такие параметры как *Volume Type* и *Volume availability zone*. Укажите *Volume type* «dp1-ssd» и нажмите «Save».

Чтобы создать план миграции нажмите «Add Migration plan». Перейдите во вкладку «Expert» и нажмите на «Generate Migration plan from all machines». Будет сгенерирован план миграции в виде документа в формате JSON, содержащий описание всех добавленных в личный кабинет хостов со значением параметров по умолчанию.

План миграции следует скорректировать таким образом, чтобы он соответствовал вашим требованиям развертывания хостов, мигрирующих в целевой проект. Пример плана миграции двух хостов:

```JSON
{
  "subnets": {
    "subnet_0": {
      "name": "subnet_0",
      "cidr": "10.0.1.0/24",
      "subnet_id": "2aebd081-44a8-480f-xxxx-yyyyyyyyyyyy"
    }
  },
  "devices": {
    "ubuntu01": {
      "id": "ec09a435-3389-d19f-4cf4-zzzzzzzzzzz",
      "security_groups": [
        "default_all"
      ],
      "availability_zone": "MS1",
      "rank": 0,
      "flavor": "Standard-4-8-80",
      "ports": [
        {
          "name": "port_0",
          "ip": "10.0.1.23",
          "floating_ip": true,
          "subnet": "subnet_0"
        }
      ]
    },
    "centos01": {
      "id": "a40d5ef3-e244-dab5-9df0-aaaaaaaaaaaa",
      "security_groups": [
        "default_all"
      ],
      "availability_zone": "DP1",
      "rank": 0,
      "flavor": "Standard-4-8-80",
      "ports": [
        {
          "name": "port_0",
          "ip": "10.0.1.27",
          "floating_ip": true,
          "subnet": "subnet_0"
        }
      ]
    }
  }
}
```

В этом плане описываются два хоста, и подсеть, в которой эти хосты будут развернуты.

На верхнем уровне документа находятся два объекта:

- subnets – содержит описание подсетей целевого проекта, к которым будут подключены мигрирующие хосты.
- devices – содержит описание хостов, которые будут развернуты в целевом проекте. Можно указать нужный тип флейвора, группы безопасности хоста, ЦОД размещения, очередность запуска, а также переопределить подсеть и ip-адрес мигрирующего хоста.

Развернутое описание этих и других параметров плана миграции можно найти в [официальной документации](https://docs.hystax.com/live-migration/migration_overview.html#migration-plan-syntax) Hystax Acura.

Далее укажите название плана миграции и нажмите кнопку «Save».

После завершения создания и настройки плана миграции, переходите к [запуску миграции](/ru/additionals/hystax/migration/launch) защищаемой инфраструктуры.
