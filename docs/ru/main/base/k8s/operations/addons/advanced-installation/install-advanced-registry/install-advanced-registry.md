Для установки Docker Registry необходима предварительная подготовка и редактирование кода аддона.

<warn>

При установке аддона для него будет создан [стандартный балансировщик нагрузки](/ru/networks/vnet/concepts/load-balancer#tipy-balansirovshchikov-nagruzki).

Использование балансировщика [тарифицируется](/ru/networks/vnet/tariffs).

</warn>

## Установка аддона

1. [Создайте](/ru/base/s3/quick-start/create-bucket) в объектном хранилище бакет, который будет использоваться для хранения Docker-образов.

   При создании выберите:
   - **Класс хранения:** `Hotbox`.
   - **Настройка ACL по умолчанию:** `private`.

1. Добавьте ключ для доступа к этому бакету:

   <tabs>
   <tablist>
   <tab>Личный кабинет</tab>
   </tablist>
   <tabpanel>

   1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
   1. Выберите проект и регион.
   1. Перейдите в раздел **Объектное хранилище → Бакеты**.
   1. Нажмите на имя созданного бакета.
   1. Перейдите на вкладку **Ключи**.
   1. Нажмите кнопку **Добавить ключ**.
   1. Задайте любое имя ключа.
   1. Прочие настройки оставьте без изменений.
   1. Нажмите кнопку **Создать**.
   1. Запишите значения **Access Key ID** и **Secret Key**.

   </tabpanel>
   </tabs>

1. Создайте зашифрованную пару логин\пароль для авторизации в реестре Docker, выполнив команду:

   ```bash
   docker run --entrypoint htpasswd registry:2.7.0 -Bbn <логин> <пароль>
   ```

   Запишите вывод команды (в формате `<логин>:<зашифрованный пароль>`).

1. [Добавьте](/ru/networks/vnet/operations/manage-floating-ip#dobavlenie-plavayushchego-ip-adresa-v-proekt) плавающий IP-адрес или [найдите](/ru/networks/vnet/operations/manage-floating-ip#prosmotr-spiska-plavayushchih-ip-adresov) существующий непривязанный плавающий IP-адрес.

   Запишите этот IP-адрес. Он будет использоваться для доступа к реестру Docker.

1. [Установите](../../manage-addons#ustanovka-addona) аддон `docker-registry`.

   Перед установкой внесите следующие изменения в код настройки аддона:

   1. Задайте реквизиты для авторизации в реестре Docker:

      ```yaml
      secrets:
        htpasswd: "<логин>:<зашифрованный пароль>"
        ...
      ```

   1. Задайте реквизиты для доступа к бакету для хранения Docker-образов:

      ```yaml
      secrets:
        ...
        s3:
          secretRef: ""
          accessKey: "<значение Access Key ID>"
          secretKey: "<значение Secret Key>"
      ...

      s3:
        ...
        bucket: <имя созданного бакета>
      ...
      ```

   1. Задайте IP-адрес для балансировщика, через который будет предоставляться доступ к сервису:

      ```yaml
      service:
        name: registry
        type: LoadBalancer
        loadBalancerIP: <выбранный плавающий IP-адрес>
        ...
      ```

   <info>

   Полный код настройки аддона вместе с описанием полей доступен на [GitHub](https://github.com/twuni/docker-registry.helm/blob/main/values.yaml).

   </info>

1. Дождитесь завершения установки аддона.

## Получение данных для доступа к реестру

Чтобы получить доступ к реестру, запишите данные, которые использовались в коде настройки аддона при его установке:

- Логин.
- Пароль.
- IP-адрес реестра. URL реестра Docker будет иметь следующий вид: `<IP-адрес>:5000`.

О том, как подключиться к реестру, читайте в разделе [Подключение к реестру Docker](../../../../connect/docker-registry).
