В общем случае способы доступа к сервисам внутри кластера [перечислены в официальной документации](https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types).

VK Cloud позволяет организовать доступ к сервисам любым из перечисленных способов:

1. **NodePort**: открывается порт на worker-узле.

   <warn>

   **Ограничение**

   В целях безопасности после создания кластера Kubernetes публичные IP-адреса не установлены ни на master-узлах, ни на worker-узлах. Пользователь может назначить такие адреса узлам после создания кластера.

   </warn>

1. **Load Balancer**: предоставляется балансировщик нагрузки.

   Сервис контейнеров Kubernetes интегрирован с облачной платформой VK Cloud:

   - Платформа предоставляет Load Balancer как сервис и может сама создавать балансировщики, обеспечивая интеграцию с кластером. Балансировщики создаются сразу в отказоустойчивой конфигурации active-standby, при которой трафик прозрачно переключается на запасной балансировщик при отказе основного балансировщика. Для организации такой конфигурации используются два экземпляра HAProxy с настроенным протоколом VRRP между ними.
   - Для подключения балансировщика к кластеру Kubernetes достаточно создать манифест с типом манифеста «сервис» и типом сервиса «Load Balancer».

     После деплоя этого манифеста автоматически происходит обращение к OpenStack API VK Cloud и создание балансировщика.

     <info>

     **Примечание**

     По умолчанию при создании балансировщика нагрузки ему назначается публичный IP-адрес.

     Если в этом нет необходимости, то в манифесте нужно прописать аннотацию `service.beta.kubernetes.io/openstack-internal-load-balancer: "true"`, тогда будет создан внутренний балансировщик, к которому можно будет обращаться только из виртуальных сетей, доступных вам в VK Cloud.

     </info>

   Для сравнения, если пользователь настраивает балансировку в Kubernetes самостоятельно, то он должен самостоятельно создать балансировщик, позаботиться об его отказоустойчивости и провести его интеграцию с кластером Kubernetes.

   **Пример манифеста для внутреннего балансировщика нагрузки:**

   ```yaml
   apiVersion: v1
   kind: Service
   metadata:
     name: nginx
     labels:
       k8s-app: nginx-backend
     annotations:
       service.beta.kubernetes.io/openstack-internal-load-balancer: "true"
   spec:
     type: LoadBalancer
     externalTrafficPolicy: Cluster
     selector:
       k8-app: nginx-backend
     ports:
       - port: 80
         name: http
         targetPort: http
       - port: 443
         name: https
         targetPort: https
   ```

1. **Ingress**: предоставляется Ingress-контроллер, который интегрируется с балансировщиком OpenStack в VK Cloud.

   Не всегда удобно создавать по балансировщику на каждый сервис, так как это может привести к сложностям управления балансировщиками на большом масштабе: 10 сервисов — 10 балансировщиков, 50 сервисов — 50 балансировщиков.

   Вместо нескольких балансировщиков на каждый сервис достаточно развернутого Ingress Controller, который уже настроен на работу с отказоустойчивым балансировщиком и балансировку по DNS-именам. Затем просто создаются несколько ресурсов Ingress, использующих этот Ingress Controller — по одному ресурсу на каждый сервис, к которому надо предоставить доступ.

   Подробнее о работе с Ingress читайте в [этой статье](../../k8s-network/k8s-ingress).
