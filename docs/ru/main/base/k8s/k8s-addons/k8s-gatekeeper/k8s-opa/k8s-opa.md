Open Policy Agent (OPA) — это механизм политик общего назначения с открытым исходным кодом, который унифицирует применение политик во всем стеке. Вы можете использовать OPA для применения политик в Kubernetes. OPA позволяет контролировать действия конечного пользователя в кластере и обеспечить соответствие кластеров политикам компании.

У каждой организации есть внутренние политики и процедуры. Одни нужны для выполнения требований управления и законодательства, а другие помогают обеспечить соблюдение лучших практик и инфраструктурных стандартов. Попытка обеспечить соответствие требованиям вручную может привести к ошибкам. Автоматизация обеспечивает согласованность, снижает задержку разработки за счет мгновенной обратной связи и повышает гибкость, позволяя разработчикам работать независимо, не жертвуя соблюдением требований.

### Требования к установке

Свежие версии GateKeeper поддерживают 4 последние стабильные версии Kubernetes. GateKeeper устанавливается автоматически в новые кластера Kubernetes от VK Cloud начиная с версии 1.21.

### Установка GateKeeper через Helm

Базовая схема управления существует в charts/gatekeeper. Если у вас установлен Helm, вы можете выполнить развертывание с помощью следующих инструкций для Helm v3:

```bash
helm repo add gatekeeper https://open-policy-agent.github.io/gatekeeper/charts
helm install gatekeeper/gatekeeper --name-template=gatekeeper --namespace opa-gatekeeper --create-namespace
```

## Удаление

Если вы использовали Helm для развертывания, выполните следующие действия, чтобы удалить Gatekeeper:

```bash
helm delete gatekeeper --namespace opa-gatekeeper
```

Helm v3 не будет очищать установленные Gatekeeper CRD. Выполните следующие действия, чтобы удалить CRD:

```bash
kubectl delete crd -l gatekeeper.sh/system=yes
```

Эта операция также удалит все изменения конфигурации, установленные пользователем, а еще политики ограничений и их шаблоны.
