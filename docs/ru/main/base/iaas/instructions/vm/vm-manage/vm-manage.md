Изменить параметры и состояние виртуальной машины на платформе VK Cloud можно в [личном кабинете](https://mcs.mail.ru/app/) или с помощью интерфейса командной строки OpenStack.

## Получение ID виртуальной машины

Для управления ВМ с помощью OpenStack CLI нужен ID виртуальной машины.

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. В списке ВМ нажмите на имя виртуальной машины, ID которой нужно узнать.
4. На странице ВМ перейдите на вкладку **Общая информация**.
5. Найдите в таблице строку **ID виртуальной машины**.

</tabpanel>

<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.

2. Выполните одно из действий.

   - Если известно имя ВМ, получите информацию о виртуальной машине и найдите строку с `id`:

      ```bash
      openstack server show <Имя ВМ>
      ```

   - Если точное имя ВМ неизвестно, выведите список виртуальных машин и найдите в нем нужную:

      ```bash
      openstack server list
      ```

</tabpanel>
</tabs>

## Запуск, остановка, перезагрузка ВМ

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Измените состояние ВМ одним из способов.

    - С помощью групповых операций — для нескольких ВМ:

        1. В списке виртуальных машин выберите ВМ, состояние которых необходимо изменить.
        2. Над списком ВМ нажмите кнопку с нужным действием.
        3. Подтвердите действие.

    - Через контекстное меню — для одной ВМ:

        1. В списке виртуальных машин найдите ВМ, состояние которой необходимо изменить.
        2. Раскройте контекстное меню ВМ.
        3. Выберите и подтвердите действие.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация**.
        3. Справа над таблицей с параметрами ВМ нажмите на значок нужного действия.
        4. Подтвердите действие.

</tabpanel>

<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.

2. Выполните нужную команду.

   - Запустить ВМ:

      ```bash
      openstack server start <ID виртуальной машины>
      ```

   - Остановить ВМ:

      ```bash
      openstack server stop <ID виртуальной машины>
      ```

   - Перезагрузить ВМ:

      ```bash
      openstack server reboot <ID виртуальной машины>
      ```

</tabpanel>
</tabs>

## Принудительный перезапуск ВМ

Если виртуальная машина не отвечает, используйте принудительный перезапуск.

<info>

Принудительный перезапуск ВМ соответствует выключению и включению питания (power cycling).<br/>Перезагрузка предполагает корректное завершение работы операционной системы ВМ (graceful shutdown).

</info>

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Вызовите принудительный перезапуск ВМ одним из способов.

    - Через контекстное меню:

        1. В списке виртуальных машин найдите нужную ВМ.
        2. Раскройте контекстное меню ВМ.
        3. Нажмите **Перезапустить принудительно** и подтвердите действие.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация**.
        3. Над таблицей с параметрами ВМ нажмите кнопку **Еще**.
        4. Нажмите **Перезапустить принудительно** и подтвердите действие.

</tabpanel>

<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.

2. Вызовите принудительный перезапуск ВМ:

   ```bash
   openstack server reboot --hard <ID виртуальной машины>
   ```

</tabpanel>
</tabs>

## Блокировка и разблокировка ВМ

Заблокируйте виртуальную машину, если нужно запретить изменение ее состояния и параметров.

Заблокированную виртуальную машину нельзя запустить или остановить, а также перезагрузить. Невозможно заменить диски и изменить настройки сетевых интерфейсов заблокированной ВМ.

<tabs>

<tablist>
<tab>Личный кабинет</tab>
</tablist>

<tabpanel>

1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Заблокируйте или разблокируйте ВМ одним из способов.

    - Через контекстное меню:

        1. В списке виртуальных машин найдите нужную ВМ.
        2. Раскройте контекстное меню ВМ.
        3. Выберите и подтвердите действие.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация**.
        3. Над таблицей с параметрами ВМ нажмите кнопку **Еще**.
        4. Выберите и подтвердите действие.

</tabpanel>
</tabs>

## Удаление ВМ

На платформе VK Cloud виртуальная машина по умолчанию удаляется вместе с основным диском (root-диск). Удаление дополнительных дисков зависит от настроек соответствующей политики.

<err>

Операция удаления необратима! Сохраните нужные данные перед удалением ВМ.

</err>

1. Подготовьте виртуальную машину к удалению.

   - Если нужно сохранить основной диск, клонируйте его или [замените на ненужный](../../vm-volumes#zamena-osnovnogo--root--diska).

   - [Отключите от ВМ](../../vm-volumes#otklyuchenie-diska-ot-vm) дополнительные диски, которые нужно сохранить.

      Дополнительные диски, для которых в политике удаления установлено свойство `delete_on_termination`: `False`, можно не отключать от ВМ.

      <details>
      <summary>Проверить политику удаления дисков — OpenStack CLI</summary>

      1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.

      2. Выполните команду:

         ```bash
         openstack server show <ID виртуальной машины> --os-compute-api-version 2.42
         ```

         Найдите строку `volumes_attached`. В ней перечислены ID дисков и указана политика их удаления — свойство `delete_on_termination` (`True` или `False`).

      </details>

2. После сохранения необходимых данных удалите виртуальную машину.

   <tabs>

   <tablist>
   <tab>Личный кабинет</tab>
   <tab>OpenStack CLI</tab>
   </tablist>

   <tabpanel>

   1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
   2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
   3. Удалите ВМ одним из способов.

      - С помощью групповых операций — для нескольких ВМ:

         1. В списке виртуальных машин выберите ВМ, которые необходимо удалить.
         2. В меню над списком ВМ нажмите кнопку **Удалить**.
         3. Подтвердите действие.

      - Через контекстное меню — для одной ВМ:

         1. В списке виртуальных машин найдите ВМ, которую необходимо удалить.
         2. Раскройте контекстное меню ВМ.
         3. Нажмите **Удалить** и подтвердите действие.

      - На странице виртуальной машины:

         1. В списке виртуальных машин нажмите на имя ВМ, которую необходимо удалить.
         2. На странице ВМ перейдите на вкладку **Общая информация**.
         3. Справа над таблицей с параметрами ВМ нажмите на значок корзины.
         4. Подтвердите действие.

   </tabpanel>

   <tabpanel>

   1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.
   2. Удалите ВМ:

      ```bash
      openstack server delete <ID виртуальной машины>
      ```

   </tabpanel>
   </tabs>

## Переименование и изменение типа ВМ

На платформе VK Cloud можно переименовать виртуальную машину, а также изменить тип ВМ — количество процессоров (vCPU) и объем оперативной памяти (RAM).

<info>

При изменении типа ВМ виртуальная машина будет перезагружена.

</info>

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Измените название или тип ВМ одним из способов.

   - Через контекстное меню:

      1. В списке виртуальных машин найдите нужную ВМ.
      2. Раскройте контекстное меню ВМ.
      3. Выберите действие.
      4. Заполните поле ввода и нажмите кнопку **Сохранить**.

   - На странице виртуальной машины:

      1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
      2. На странице ВМ перейдите на вкладку **Общая информация**.
      3. Над таблицей с параметрами ВМ нажмите кнопку **Еще**.
      4. Выберите действие.
      5. Заполните поле ввода и нажмите кнопку **Сохранить**.

</tabpanel>

<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.

2. Выполните нужное действие.

   - Переименовать ВМ:

      ```bash
      openstack server set --name <новое имя> <ID виртуальной машины>
      ```

   - Изменить тип ВМ:

      1. Получите список доступных шаблонов конфигурации и скопируйте ID шаблона:

         ```bash
         openstack flavor list --all
         ```

      2. Запустите изменение типа ВМ и дождитесь окончания процесса:

         ```bash
         openstack server resize --flavor <ID шаблона> <ID виртуальной машины>
         ```

</tabpanel>
</tabs>

## Присвоение тегов

Теги позволяют отфильтровать список виртуальных машин и быстрее найти нужную ВМ. Используйте существующие теги или создайте собственный тег и выберите для него цвет.

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Раскройте контекстное меню ВМ.
4. Отметьте флажками теги или нажмите **Создать новый тег**.
5. Для добавления нового тега введите его имя, выберите цвет и нажмите кнопку **Добавить тег**.

</tabpanel>

<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.

2. Выполните нужную команду.

   - Вывести список тегов ВМ:

      ```bash
      nova server-tag-list <ID виртуальной машины>
      ```

   - Присвоить тег ВМ:

      ```bash
      nova server-tag-add <ID виртуальной машины> <тег>
      ```

   - Удалить тег у ВМ:

      ```bash
      nova server-tag-delete <ID виртуальной машины> <тег>
      ```

   - Удалить все теги у ВМ:

      ```bash
      nova server-tag-delete-all <ID виртуальной машины>
      ```

</tabpanel>
</tabs>

## Установка и изменение пароля

В операционной системе виртуальной машины VK Cloud можно установить или изменить пароль для пользователя по умолчанию.

Условия для установки пароля:

- виртуальная машина запущена и процесс загрузки ОС завершился;
- установлен и запущен гостевой агент QEMU (состояние — `running`).

<info>

В виртуальных машинах, созданных из образа VK Cloud, гостевой агент QEMU есть по умолчанию.

</info>

Команда для проверки состояния гостевого агента QEMU:

<tabs>

<tablist>
<tab>Windows</tab>
<tab>Linux</tab>
</tablist>

<tabpanel>

```bash
sc query qemu-ga
```

</tabpanel>

<tabpanel>

```bash
systemctl status qemu-guest-agent
```

</tabpanel>

</tabs>

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Установите пароль одним из способов.

    - Через контекстное меню:

        1. В списке виртуальных машин найдите нужную ВМ.
        2. Раскройте контекстное меню ВМ.
        3. Выберите **Установить пароль**.
        4. Введите новый пароль или нажмите кнопку **Сгенерировать**.
        5. Нажмите кнопку **Задать пароль**.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация** или на вкладку **Консоль**.
        3. Над таблицей с параметрами ВМ или над окном с консолью нажмите кнопку **Установить пароль**.
        4. Введите новый пароль или нажмите кнопку **Сгенерировать**.
        5. Нажмите кнопку **Задать пароль**.

</tabpanel>

<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.

2. Установите пароль:

   ```bash
   openstack server set --root-password <ID виртуальной машины>
   ```

</tabpanel>

</tabs>

<info>

Пароль должен быть длиной от 8 символов и содержать буквы латинского алфавита, цифры и символы ``! " # $ % & ( ) * + , - . : ; < = > ? @ [ ] ^ _ ` { } ~``.

</info>

## Восстановление пароля

Восстановление пароля, сгенерированного для пользователя по умолчанию, доступно только для виртуальных машин Windows, созданных в приватной сети. Чтобы получить пароль, необходим приватный ключ ключевой пары, выбранной при создании ВМ.

<warn>

Если после создания ВМ пароль был изменен или ВМ была создана в сети `ext-net`, [установите новый пароль](#ustanovka-i-izmenenie-parolya).

</warn>

<tabs>

<tablist>
<tab>Личный кабинет</tab>
</tablist>

<tabpanel>

1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Откройте окно получения пароля одним из способов.

    - Через контекстное меню:

        1. В списке виртуальных машин найдите нужную ВМ.
        2. Раскройте контекстное меню ВМ.
        3. Выберите **Получить пароль**.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация**.
        3. Над таблицей с параметрами ВМ нажмите кнопку **Еще**.
        4. Выберите **Получить пароль**.

4. В открывшемся окне нажмите **Файл приватного ключа** или вставьте содержимое ключа в поле **Приватный ключ**.
5. Нажмите кнопку **Расшифровать пароль**.
6. В окне появится поле **Пароль**. Скопируйте пароль, нажав значок в поле.

</tabpanel>

</tabs>

## Восстановление доступа к ВМ по ключу

Для восстановления доступа к виртуальной машине Linux по SSH с использованием ключевой пары необходимо знать пароль пользователя ОС.

1. Получите публичный ключ.

   - Если утрачен файл с публичным ключом, перейдите в директорию с файлом приватного ключа и выполните команду:

      ```bash
      ssh-keygen -y -f <имя файла с приватным ключом> > <имя файла с публичным ключом>
      ```

   - Если утрачен файл с приватным ключом, [создайте новую ключевую пару](/base/account/account/keypairs/create).

2. Создайте ссылку на файл с публичным ключом.

   1. Перейдите в [личный кабинет](https://mcs.mail.ru/app/) VK Cloud.
   2. Перейдите в раздел **Объектное хранилище → Бакеты**.
   3. Используйте существующий бакет или [создайте новый](/base/s3/quick-start/create-bucket).
   4. [Добавьте файл](/base/s3/quick-start/upload-object) с публичным ключом в бакет.
   5. [Включите доступ](/base/s3/quick-start/object-access) по ссылке к этому файлу.
   6. Скопируйте ссылку на файл с публичным ключом.

3. Загрузите публичный ключ на виртуальную машину.

   1. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
   2. В списке виртуальных машин нажмите на имя нужной ВМ.
   3. На странице ВМ перейдите на вкладку **Консоль**.
   4. Используйте имя пользователя по умолчанию и пароль для входа в ОС ВМ.
   5. Скачайте файл с публичным ключом:

      ```bash
      wget <ссылка на файл с публичным ключом>
      ```

   6. Скопируйте публичный ключ в файл `authorized_keys`:

      ```bash
      cat <файл с публичным ключом> >> ~/.ssh/authorized_keys
      ```

4. Проверьте возможность доступа по ключу.

   1. Перейдите в терминал компьютера, на котором хранится приватный ключ.
   2. Подключитесь к ВМ по SSH:

      ```bash
      ssh -i <путь к файлу с приватным ключом> <логин>@<внешний IP-адрес ВМ>
      ```

## Просмотр журнала событий

Журнал событий содержит информацию об изменении состояния ВМ и о действиях пользователя.

<tabs>

<tablist>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1--ustanovite-klient-openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3--proydite-autentifikaciyu) в проекте.

2. Выполните нужную команду.

   - Просмотреть журнал событий (расширенный формат):

      ```bash
      openstack server event list --long <ID виртуальной машины>
      ```

   - Просмотреть журнал событий (краткий формат):

      ```bash
      openstack server event list <ID виртуальной машины>
      ```

   - Используйте ID события из колонки **Request ID**, чтобы вывести подробную информацию о событии:

      ```bash
      openstack server event show <ID виртуальной машины> <ID события>
      ```

Примеры событий:

- `start` / `stop` — запуск / остановка ВМ;
- `resize` / `confirmResize` — запуск изменения типа ВМ / подтверждение;
- `extend_volume` — увеличение размера диска;
- `create` — создание ВМ;
- `live-migration` — миграция ВМ.

</tabpanel>

</tabs>
