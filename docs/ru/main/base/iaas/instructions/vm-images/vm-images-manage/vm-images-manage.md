Образ — это файл, который содержит виртуальный диск с установленной операционной системой или другими данными. Образы используются для создания виртуальных машин в облаке.

## Создание образа

Сервис VK Cloud позволяет создать образ из диска существующей виртуальной машины.

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://mcs.mail.ru/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Образы**.
3. Нажмите кнопку **Создать**.
4. В появившемся окне:

   1. **Источник**: выберите **Диск**.
   2. **Выберите диск**: выберите диск существующей виртуальной машины. ВМ должна быть остановлена.
   3. **Название образа**: укажите имя образа.
   4. Нажмите кнопку **Создать образ**.

</tabpanel>
<tabpanel>

<warn>

Диск для создания образа должен быть отсоединен от виртуальной машины и иметь статус `available`.

</warn>

1. Получите `ID` диска:

   ```bash
   openstack volume list
   ```

2. Создайте образ:

   ```bash
   openstack image create --volume <ID диска> <название образа>
   ```

3. Проверьте создание образа:

   ```bash
   openstack image list --name <название образа>
   ```

   Успешно созданный образ должен иметь статус `active`.

</tabpanel>
</tabs>

## Импорт образа

Сервис VK Cloud поддерживает загрузку собственных образов виртуальных машин с [некоторыми ограничениями](/ru/base/iaas/concepts/vm-concept#operacionnaya_sistema) по операционным системам.

<info>

Поддерживаются только образы в формате RAW. Если ваш образ в другом формате, [выполните его конвертацию](../../../use-cases/packer#1_konvertiruyte_obraz_v_format_raw).

</info>

<warn>

Рекомендованный способ импорта образа — с использованием CLI.

При загрузке через Личный кабинет размер загружаемого файла ограничен — не более 100 Гб.

</warn>

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://mcs.mail.ru/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Образы**.
3. Нажмите кнопку **Создать**.
4. В появившемся окне:

   1. **Источник**: выберите **Файл**.
   2. **Выберите файл**: загрузите файл образа в формате RAW.
   3. **Название образа**: укажите имя образа.
   4. Нажмите кнопку **Создать образ**.

</tabpanel>
<tabpanel>

Параметры команды импорта образа зависят от необходимости поддержки резервного копирования:

- Если поддержка не нужна, выполните команду:

   ```bash
   openstack image create --private --container-format bare --disk-format raw --property store=s3 --file <путь к файлу образа> <название образа>
   ```

- Если поддержка нужна, добавьте параметры `--property hw_qemu_guest_agent=yes --property os_require_quiesce=yes` в команду выше.

</tabpanel>
</tabs>

## Экспорт образа

<tabs>
<tablist>
<tab>OpenStack CLI</tab>
<tab>cURL</tab>
</tablist>
<tabpanel>

1. Получите `ID` образа из списка:

   ```bash
   openstack image list
   ```

2. Экспортируйте образ:

   ```bash
   openstack image save --file <название файла образа>.raw <ID образа>
   ```

</tabpanel>
<tabpanel>

1. [Получите](/ru/additionals/cases/case-keystone-token) токен доступа `X-Auth-Token`.
1. Выполните команду:

   ```bash
   curl -H "X-Auth-Token:{токен}" "https://infra.mail.ru:9292/v2/images/{ID образа}/file" --output <название файла образа>.raw
   ```

</tabpanel>
</tabs>

## Изменение статуса видимости образа

Изменение статуса видимости образа позволяет получить доступ к образу из нескольких проектов. Совместный доступ к образу в нескольких проектах позволяет ускорить разворачивание виртуальных машин.

В сервисе VK Cloud используются следующие статусы видимости образов:

| Статус      | Описание                                            |
|-------------|-----------------------------------------------------|
| `private`   | Образ только для личного доступа                    |
| `community` | Образ доступен для сообщества                       |
| `shared`    | Образ может быть использован в нескольких проектах  |

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

<info>

Через личный кабинет можно разрешить доступ к образу только для определенных проектов.

</info>

Чтобы изменить статус видимости образа:

1. [Перейдите](https://mcs.mail.ru/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Образы**.
3. Раскройте меню нужного образа и выберите **Поделиться образом**.
4. В появившемся окне:

   1. Выберите одно из действий:

      - **Мои проекты**: выберите нужные проекты из выпадающего списка.
      - **Другие проекты**: укажите ID проекта.

   2. Нажмите кнопку **Разрешить доступ**.

</tabpanel>
<tabpanel>

Чтобы изменить статус видимости образа:

1. Получите `ID` образа из списка:

   ```bash
   openstack image list
   ```

2. Отобразите подробную информацию об отдельном образе:

   ```bash
   openstack image show <ID образа>
   ```

   Статус видимости образа отображается в строке `visibility`.

3. Измените статус образа:

   ```bash
   openstack image set --<статус> <ID образа>
   ```

Чтобы поделиться образом в статусе `shared`:

1. Добавьте образ в проект:

   ```bash
   openstack image add project <ID образа> <ID проекта>
   ```

2. Подтвердите добавление образа в проект:

   ```bash
   openstack image set --accept <ID образа>
   ```

Для просмотра проектов, имеющих доступ к образу, выполните команду:

```bash
openstack image member list <ID образа>
```

</tabpanel>
</tabs>

## Удаление образа

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://mcs.mail.ru/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Образы**.
3. Выполните одно из действий для нужного образа:

   - Выберите с помощью флажка образ, затем нажмите кнопку **Удалить**.
   - Раскройте меню нужного образа и выберите **Удалить образ**.

4. Нажмите кнопку **Подтвердить**.

</tabpanel>
<tabpanel>

Чтобы удалить образ, не прикрепленный к проектам:

```bash
openstack image delete <ID образа>
```

Чтобы удалить образ из проекта:

```bash
openstack image remove project <ID образа> <ID проекта>
```

</tabpanel>
</tabs>
