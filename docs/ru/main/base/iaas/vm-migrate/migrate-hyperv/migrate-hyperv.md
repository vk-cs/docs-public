Миграция виртуальных машин между сервисами/платформами, на которых их можно запускать и эксплуатировать, как правило, состоит из нескольких этапов.

<warn>

Перед миграцией ВМ убедитесь, что следующие требования соблюдены:

- Операционная система имеет 64-битную архитектуру;
- ВМ использует БИОС;
- Текущий пользователь обладает правами Администратора;
- ВМ должна иметь хотя бы один подключенный диск.

</warn>

## Подготовка к миграции

Перед миграцией виртуальной машины следует произвести подготовительные действия, направленные на обеспечение функционалом имеющийся виртуальный сервер:

### Интеграция драйверов

"ВиртИО".

- [Windows](https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.171-1/) - скачивание и [инструкция](https://www.linux-kvm.org/page/WindowsGuestDrivers/Download_Drivers) к установке.
- [Linux](https://www.linux-kvm.org/page/Virtio) - скачивание и [инструкции](https://www.linux-kvm.org/page/Virtio) к установке.

В некоторых случаях, при невозможности автоматической установки драйверов, может потребоваться их ручное добавление и установка драйверов из загруженного пакета драйверов ВиртИО.

После установки драйверов необходимо установить гостевой агент Гостевой агент QEMU. Используется установщик, соответствующий архитектуре имеющейся виртуальной машины.

### Добавление драйверов в реестр

Для корректного определения драйверов необходимо добавить их в системный реестр Окна.

Для этого следует:

1. Загрузить [Файл реестра Virtio](http://migration.platform9.com.s3-us-west-1.amazonaws.com/virtio.reg ) на инстанс.
2. « Windows».

## Экспорт виртуальной машины

<warn>

Перед проведением операций экспорта виртуальную машину необходимо остановить.

</warn>

Существует несколько способов эскпорта ВМ из Hyper-V:

- Менеджер Hyper-V;
- PowerShell.

### Менеджер Hyper-V

Для экспорта виртуальной машины в файл следует выбрать желаемую ВМ, затем экспортировать ее, использую функцию экспорта в меню виртуальной машины.

В окне экспорта следует указать путь для сохранения экспортируемого объекта.

### PowerShell

Экспортировать необходимую виртуальную машину можно с помощью команды:

```bash
Экспорт-Имя виртуальной машины <имя___машины> -Путь '<__путь>'
```

## Загрузка образа ВМ в ВКОНТАКТЕ CS

Полученный в результате экспорта файл \*.vhdx следует загрузить в существующий проект VK Cloud.

чтобы избежать возможных ошибок обработки веб интерфейсом файлов большого размера CLI Openstack, чтобы избежать возможных ошибок обработки веб интерфейсом файлов большого размера. следует воспользоваться командой \*.vhdx следует воспользоваться командой:

```bash
openstack image create --private --container-format bare --disk-format vhdx --хранилище свойств=s3 --файл <файл.vhdx> <название_образа>
```

Если инстанс, созданный из образа, должен поддерживать резервное копирование, необходимо загрузить его с указанием метаданных наличия гостевого агента:

```bash
openstack image create --private --container-format bare --disk-format vhdx --file <файл.vhdx> --свойство hw_qemu_guest_agent=да --хранилище свойств=s3 --свойство os_require_quiesce=да <__образа>
```
