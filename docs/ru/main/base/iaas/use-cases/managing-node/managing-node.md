Распределение групп серверов (server groups) одного сервиса или приложения на кластере зависит от решаемых задач:

- Если в сервисе есть несколько групп серверов (ВМ, инстансов БД) с одной ролью, например, несколько серверов приложений, распределите их по разных физическим серверам, чтобы повысить отказоустойчивость.
- Если в сервисе есть группы серверов с разными ролями, для которых критична задержка при взаимодействии (например, сервер приложений и сервер баз данных), разместите их на одном вычислительном узле, чтобы трафик проходил в рамках одного физического сервера.

VK Cloud поддерживает [четыре политики распределения групп серверов](../../concepts/vm-concept#gruppa_serverov), для `soft`-политик необходима поддержка версии `compute-api` выше 2.15.

<warn>

Допустимые операции для групп серверов:

- создать новые серверы в группе;
- удалять существующие серверы в группе.

Недопустимые операции для серверных групп:

- добавлять существующий сервер в группу;
- удалить группу серверов, не удалив все его серверы.

</warn>

Чтобы определить правила распределения групп серверов, укажите группу в свойствах инстанса:

1. Выведите список групп серверов с помощью команды:

    ```bash
    openstack server group list
    ```

1. Найдите группу серверов с политикой вида `affinity` или `anti-affinity`. Если групп серверов не найдено, создайте ее с помощью команды:

    ```bash
    ​openstack server group create <название группы серверов> --policy <политика>
    ```

1. Создайте загрузочные диски для будущих ВМ. Пример для трех дисков:

   ```bash
   for i in 1 2 3;do openstack volume create --size 10 --image 98af6254-XXXX-XXXX-XXXX-81858ce9302a --availability-zone MS1 --bootable root-volume-$i;done
   ```

1. Создайте необходимые виртуальные машины с указанием группы серверов. Пример для трех ВМ:

    ```bash
    for i in 1 2 3;do openstack --insecure server create --flavor Basic-1-1 --volume root-volume-$i --hint group=<ID со свойством политики> --nic net-id=<ID сети> vm-affinity-$i;done
    ```

1. Дождитесь окончания создания ВМ. Убедитесь, что разворачиваемые ВМ успешно созданы и находятся в статусе `ACTIVE`.

<info>

Если не найдено вычислительных узлов, удовлетворяющих ограничениям, запросы на создание ресурсов завершатся ошибкой.

</info>
