SSH — самый распространенный и безопасный способ подключения к серверу с ОС Linux. Имеет два основных способа аутентификации:
- По паролю: в образах VK Cloud по умолчанию отключено в целях безопасности.
- С помощью SSH ключа: наиболее безопасный способ подключения. Используется по умолчанию в образах VK Cloud.

## {heading(Подготовительные шаги)[id=preparatory_steps]}

1. Проверьте, что у вас есть файл приватного ключа `*.pem`, который скачивается при [установке ОС](/ru/computing/bare-metal/instructions/os-setup) из образов VK Cloud.
1. Убедитесь, что сервер Bare Metal запущен, и процесс загрузки ОС завершился, например, через [VNC-консоль](/ru/computing/bare-metal/connect/console).
1. Если на сервере используются инструменты сетевой фильтрации (`ufw`, `nftables`, `iptables` и др.), добавьте правило для доступа по протоколу SSH (TCP-порт `22`);
1. Убедитесь, что служба SSH на сервере Bare Metal запущена и работает. Проверить статус службы можно с помощью команды:

   ```shell
   sudo service sshd status
   ```

{note:warn}

Если подключение к виртуальной машине по SSH невозможно или недоступно, используйте [VNC-консоль](/ru/computing/bare-metal/connect/console).

{/note}

## {heading(Подключение к серверу Bare Metal)[id=connect]}

{tabs}

{tab(Linux/macOS)}

1. Откройте терминал и настройте права доступа к файлу ключа:

   ```bash
   chmod 400 <ФАЙЛ_КЛЮЧА>
   ```

   Здесь `<ФАЙЛ_КЛЮЧА>` — путь до `*.pem` файла с приватным ключом.

   Пример для файла ключа `MyPrivateKey.pem`, который находится в директории `/path/to/file/`:

   ```bash
   chmod 400 /path/to/file/MyPrivateKey.pem
   ```

1. Подключитесь к серверу:

   {tabs}

   {tab(По внешнему IP-адресу)}

   Если для вашего сервера настроено подключение по внешнему IP-адресу (например, через продвинутый маршрутизатор), выполните команду:

   ```bash
   ssh -i <ФАЙЛ_КЛЮЧА> \
          <ИМЯ_ПОЛЬЗОВАТЕЛЯ>@<ВНЕШНИЙ_IP-АДРЕС_СЕРВЕРА>
   ```

   Здесь:

   - `<ФАЙЛ_КЛЮЧА>` — путь до `*.pem` файла с приватным ключом.
   - `<ИМЯ_ПОЛЬЗОВАТЕЛЯ>` — имя учетной записи по умолчанию, которое [используется в образах VK Cloud](/ru/computing/iaas/concepts/oper-system#default_account).
   - `<ВНЕШНИЙ_IP-АДРЕС_СЕРВЕРА>` — IP-адрес, который настроен для подключения к серверу извне.

   {include(/ru/_includes/_ssh-warning.md)[tags=new-host]}

   {/tab}

   {tab(По внутреннему IP-адресу)}

   Если ваш сервер Bare Metal не имеет внешнего IP-адреса, подключитесь к нему через промежуточный сервер:
   
   1. Настройте промежуточный сервер, если он еще не настроен. Промежуточным сервером может быть, например, [виртуальная машина](/ru/computing/iaas/concepts/vm), которая:

      - находится к той же сети, что и сервер Bare Metal;
      - имеет внешний IP-адрес.

      Если у вас нет ВМ, соответствующей таким требованиям:

      1. [Узнайте](/ru/computing/bare-metal/instructions/manage-server#get-info) к какой сети подключен ваш сервер Bare Metal и его внутренний IP-адрес.
      1. [Создайте новую](/ru/computing/iaas/instructions/vm/vm-create) или [подключите уже существующую](/ru/computing/iaas/instructions/vm/vm-add-net) ВМ с параметрами:

         - **Сеть**: выберите ту же сеть, к которой подключен сервер Bare Metal.
         - **Назначить внешний IP-адрес**: включите эту опцию.

      1. Проверьте, что подключение к промежуточному серверу по внешнему IP работает.
   
   1. Подключитесь к серверу Bare Metal.

      Сначала необходимо подключиться к промежуточному серверу через его внешний IP, а затем уже к серверу Bare Metal по его внутреннему IP. Это можно сделать одной командой:

         ```bash
         ssh -i <ФАЙЛ_КЛЮЧА> \
             -J <ИМЯ_ПОЛЬЗОВАТЕЛЯ>@<IP-АДРЕС_ПРОМЕЖУТОЧНОГО_СЕРВЕРА> \
                <ИМЯ_ПОЛЬЗОВАТЕЛЯ>@<ВНУТРЕННИЙ_IP-АДРЕС_СЕРВЕРА>
         ```

         Здесь:

         - `<ФАЙЛ_КЛЮЧА>` — путь до `*.pem` файла с приватным ключом.
         - `<ИМЯ_ПОЛЬЗОВАТЕЛЯ>` — имя учетной записи по умолчанию, которое [используется в образах VK Cloud](/ru/computing/iaas/concepts/oper-system#default_account). И для промежуточного, и для сервера Bare Metal, нужно ввести имя пользователя, соответствующее используемому в них образу ОС.
         - `<IP-АДРЕС_ПРОМЕЖУТОЧНОГО_СЕРВЕРА>` — внешний IP-адрес промежуточного сервера.
         - `<ВНУТРЕННИЙ_IP-АДРЕС_СЕРВЕРА>` — внутренний IP-адрес вашего сервера Bare Metal.

      {include(/ru/_includes/_ssh-warning.md)[tags=new-host]}

   {/tab}

   {/tabs}

{/tab}

{tab(Windows 10/11)}

1. Настройте права доступа к файлу приватного ключа:

   1. Откройте свойства файла приватного ключа `.pem`.
   1. Перейдите на вкладку **Безопасность** и нажмите кнопку **Дополнительно**. Откроется окно **Дополнительные параметры безопасности**.
   1. Нажмите кнопку **Отключение наследования** и в открывшемся окне выберите **Удалить все унаследованные разрешения из этого объекта**.
   1. В окне **Дополнительные параметры безопасности** нажмите кнопку **Добавить**.
   1. В открывшемся окне нажмите **Выберите субъект** и укажите пользователя ОС Windows, от имени которого будет запущена командная строка для подключения к ВМ.
   1. Подтвердите изменения, последовательно нажав **ОК** в открытых окнах настроек.

1. Подключитесь к серверу:

   {tabs}

   {tab(По внешнему IP-адресу)}

   Если для вашего сервера настроено подключение по внешнему IP-адресу (например, через продвинутый маршрутизатор), выполните команду:

   ```ps
   ssh -i <ФАЙЛ_КЛЮЧА> `
          <ИМЯ_ПОЛЬЗОВАТЕЛЯ>@<ВНЕШНИЙ_IP-АДРЕС_СЕРВЕРА>
   ```

   Здесь:

   - `<ФАЙЛ_КЛЮЧА>` — путь до `*.pem` файла с приватным ключом.
   - `<ИМЯ_ПОЛЬЗОВАТЕЛЯ>` — имя учетной записи по умолчанию, которое [используется в образах VK Cloud](/ru/computing/iaas/concepts/oper-system#default_account).
   - `<ВНЕШНИЙ_IP-АДРЕС_СЕРВЕРА>` — IP-адрес, который настроен для подключения к серверу извне.

   {include(/ru/_includes/_ssh-warning.md)[tags=new-host]}

   {/tab}

   {tab(По внутреннему IP-адресу)}

   Если ваш сервер Bare Metal не имеет внешнего IP-адреса, подключитесь к нему через промежуточный сервер:
   
   1. Настройте промежуточный сервер, если он еще не настроен. Промежуточным сервером может быть, например, [виртуальная машина](/ru/computing/iaas/concepts/vm), которая:
      
      - находится к той же сети, что и сервер Bare Metal;
      - имеет внешний IP-адрес.

      Если у вас нет ВМ, соответствующей таким требованиям:

      1. [Узнайте](/ru/computing/bare-metal/instructions/manage-server#get-info) к какой сети подключен ваш сервер Bare Metal и его внутренний IP-адрес.
      1. [Создайте новую](/ru/computing/iaas/instructions/vm/vm-create) или [подключите уже существующую](/ru/computing/iaas/instructions/vm/vm-add-net) ВМ с параметрами:

         - **Сеть**: выберите ту же сеть, к которой подключен сервер Bare Metal.
         - **Назначить внешний IP-адрес**: включите эту опцию.

      1. [Проверьте](/ru/computing/iaas/instructions/vm/vm-connect/vm-connect-nix#4_podklyuchites_k_vm) что подключение к промежуточному серверу по внешнему IP работает.
   
   1. Подключитесь к серверу Bare Metal.

      Сначала необходимо подключиться к промежуточному серверу через его внешний IP, а затем уже к серверу Bare Metal по его внутреннему IP. Это можно сделать одной командой:

         ```ps
         ssh -i <ФАЙЛ_КЛЮЧА> `
             -J <ИМЯ_ПОЛЬЗОВАТЕЛЯ>@<IP-АДРЕС_ПРОМЕЖУТОЧНОГО_СЕРВЕРА> `
                <ИМЯ_ПОЛЬЗОВАТЕЛЯ>@<ВНУТРЕННИЙ_IP-АДРЕС_СЕРВЕРА>
         ```

         Здесь:

         - `<ФАЙЛ_КЛЮЧА>` — путь до `*.pem` файла с приватным ключом.
         - `<ИМЯ_ПОЛЬЗОВАТЕЛЯ>` — имя учетной записи по умолчанию, которое [используется в образах VK Cloud](/ru/computing/iaas/concepts/oper-system#default_account). И для промежуточного, и для сервера Bare Metal, нужно ввести имя пользователя, соответствующее используемому в них образу ОС.
         - `<IP-АДРЕС_ПРОМЕЖУТОЧНОГО_СЕРВЕРА>` — внешний IP-адрес промежуточного сервера.
         - `<ВНУТРЕННИЙ_IP-АДРЕС_СЕРВЕРА>` — внутренний IP-адрес вашего сервера Bare Metal.

      {include(/ru/_includes/_ssh-warning.md)[tags=new-host]}

   {/tab}

   {/tabs}

{/tab}

{/tabs}
