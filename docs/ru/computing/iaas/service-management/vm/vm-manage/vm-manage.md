Изменить параметры и состояние виртуальной машины на платформе VK Cloud можно в [личном кабинете](https://msk.cloud.vk.com/app/) или с помощью интерфейса командной строки OpenStack.

## Получение ID виртуальной машины

Для управления ВМ с помощью OpenStack CLI нужен ID виртуальной машины.

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. В списке ВМ нажмите на имя виртуальной машины, ID которой нужно узнать.
4. На странице ВМ перейдите на вкладку **Общая информация**.
5. Найдите в таблице строку **ID виртуальной машины**.

</tabpanel>

<tabpanel>

1. [Установите](/ru/tools-for-using-services/cli/openstack-cli) клиент OpenStack и пройдите аутентификацию в проекте, если этого еще не сделано.

2. Выполните одно из действий.

   - Если известно имя ВМ, получите информацию о виртуальной машине и найдите строку с `id`:

      ```bash
      openstack server show <Имя ВМ>
      ```

   - Если точное имя ВМ неизвестно, выведите список виртуальных машин и найдите в нем нужную:

      ```bash
      openstack server list
      ```

</tabpanel>
</tabs>

## {heading(Запуск, остановка, перезагрузка ВМ)[id=start_stop_restart_vm]}

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Измените состояние ВМ одним из способов.

    - С помощью групповых операций — для нескольких ВМ:

        1. В списке виртуальных машин выберите с помощью флажков ВМ, состояние которых необходимо изменить.
        2. Над списком ВМ нажмите кнопку с нужным действием.
        3. Подтвердите действие.

    - Через контекстное меню — для одной ВМ:

        1. В списке виртуальных машин нажмите ![ ](/ru/assets/more-icon.svg "inline") для ВМ, состояние которой необходимо изменить.
        1. Выберите и подтвердите действие.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация**.
        3. Справа над таблицей с параметрами ВМ нажмите на значок нужного действия.
        4. Подтвердите действие.

</tabpanel>

<tabpanel>

1. [Установите](/ru/tools-for-using-services/cli/openstack-cli) клиент OpenStack и пройдите аутентификацию в проекте, если этого еще не сделано.

2. Выполните нужную команду.

   - Запустить ВМ:

      ```bash
      openstack server start <ID виртуальной машины>
      ```

   - Остановить ВМ:

      ```bash
      openstack server stop <ID виртуальной машины>
      ```

   - Перезагрузить ВМ:

      ```bash
      openstack server reboot <ID виртуальной машины>
      ```

</tabpanel>
</tabs>

## Принудительный перезапуск ВМ

Если виртуальная машина не отвечает, используйте принудительный перезапуск.

<info>

Принудительный перезапуск ВМ соответствует выключению и включению питания (power cycling).<br/>Перезагрузка предполагает корректное завершение работы операционной системы ВМ (graceful shutdown).

</info>

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Вызовите принудительный перезапуск ВМ одним из способов.

    - Через контекстное меню:

        1. В списке виртуальных машин нажмите ![ ](/ru/assets/more-icon.svg "inline") для нужной ВМ.
        1. Выберите пункт **Перезапустить принудительно** и подтвердите действие.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация**.
        3. Над таблицей с параметрами ВМ нажмите кнопку **Еще**.
        4. Нажмите **Перезапустить принудительно** и подтвердите действие.

</tabpanel>

<tabpanel>

1. [Установите](/ru/tools-for-using-services/cli/openstack-cli) клиент OpenStack и пройдите аутентификацию в проекте, если этого еще не сделано.

2. Вызовите принудительный перезапуск ВМ:

   ```bash
   openstack server reboot --hard <ID виртуальной машины>
   ```

</tabpanel>
</tabs>

## Блокировка и разблокировка ВМ

Заблокируйте виртуальную машину, если нужно запретить изменение ее состояния и параметров.

Заблокированную виртуальную машину нельзя запустить или остановить, а также перезагрузить. Невозможно заменить диски и изменить настройки сетевых интерфейсов заблокированной ВМ.

<tabs>

<tablist>
<tab>Личный кабинет</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Заблокируйте или разблокируйте ВМ одним из способов.

    - Через контекстное меню:

        1. В списке виртуальных машин нажмите ![ ](/ru/assets/more-icon.svg "inline") для нужной ВМ.
        1. Выберите и подтвердите действие.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация**.
        3. Над таблицей с параметрами ВМ нажмите кнопку **Еще**.
        4. Выберите и подтвердите действие.

</tabpanel>
</tabs>

## {heading(Удаление ВМ)[id=delete_vm]}

На платформе VK Cloud виртуальная машина по умолчанию удаляется вместе с основным диском (root-диск). Удаление дополнительных дисков зависит от настроек соответствующей политики.

<err>

Операция удаления необратима! Сохраните нужные данные перед удалением ВМ.

</err>

1. Подготовьте виртуальную машину к удалению.

   - Если нужно сохранить основной диск, клонируйте его или [замените на ненужный](../../volumes#zamena_osnovnogo_root_diska).

   - [Отключите от ВМ](../../volumes#otklyuchenie_diska_ot_vm) дополнительные диски, которые нужно сохранить.

      Дополнительные диски, для которых в политике удаления установлено свойство `delete_on_termination`: `False`, можно не отключать от ВМ.

      <details>
      <summary>Проверить политику удаления дисков — OpenStack CLI</summary>

      1. Убедитесь, что клиент OpenStack [установлен](/ru/tools-for-using-services/cli/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/tools-for-using-services/cli/openstack-cli#3_proydite_autentifikaciyu) в проекте.

      2. Выполните команду:

         ```bash
         openstack server show <ID виртуальной машины> --os-compute-api-version 2.42
         ```

         Найдите строку `volumes_attached`. В ней перечислены ID дисков и указана политика их удаления — свойство `delete_on_termination` (`True` или `False`).

      </details>

2. После сохранения необходимых данных удалите виртуальную машину.

   <tabs>

   <tablist>
   <tab>Личный кабинет</tab>
   <tab>OpenStack CLI</tab>
   </tablist>

   <tabpanel>

   1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
   2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
   3. Удалите ВМ одним из способов.

      - С помощью групповых операций — для нескольких ВМ:

         1. В списке виртуальных машин выберите ВМ, которые необходимо удалить.
         2. В меню над списком ВМ нажмите кнопку **Удалить**.
         3. Подтвердите действие.

      - Через контекстное меню — для одной ВМ:

         1. В списке виртуальных машин нажмите ![ ](/ru/assets/more-icon.svg "inline") для ВМ, которую необходимо удалить.
         1. Выберите пункт **Удалить** и подтвердите действие.

      - На странице виртуальной машины:

         1. В списке виртуальных машин нажмите на имя ВМ, которую необходимо удалить.
         2. На странице ВМ перейдите на вкладку **Общая информация**.
         3. Справа над таблицей с параметрами ВМ нажмите на значок корзины.
         4. Подтвердите действие.

   </tabpanel>

   <tabpanel>

   1. [Установите](/ru/tools-for-using-services/cli/openstack-cli) клиент OpenStack и пройдите аутентификацию в проекте, если этого еще не сделано.
   2. Удалите ВМ:

      ```bash
      openstack server delete <ID виртуальной машины>
      ```

   </tabpanel>
   </tabs>

## Переименование и изменение типа ВМ

На платформе VK Cloud можно переименовать виртуальную машину, а также изменить тип ВМ — количество процессоров (vCPU) и объем оперативной памяти (RAM).

<info>

При изменении типа ВМ виртуальная машина будет перезагружена.

</info>

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Измените название или тип ВМ одним из способов.

   - Через контекстное меню:

      1. В списке виртуальных машин нажмите ![ ](/ru/assets/more-icon.svg "inline") для нужной ВМ.
      1. Выберите действие.
      1. Заполните поле ввода и нажмите кнопку **Сохранить**.

   - На странице виртуальной машины:

      1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
      2. На странице ВМ перейдите на вкладку **Общая информация**.
      3. Над таблицей с параметрами ВМ нажмите кнопку **Еще**.
      4. Выберите действие.
      5. Заполните поле ввода и нажмите кнопку **Сохранить**.

</tabpanel>

<tabpanel>

1. [Установите](/ru/tools-for-using-services/cli/openstack-cli) клиент OpenStack и пройдите аутентификацию в проекте, если этого еще не сделано.

2. Выполните нужное действие.

   - Переименовать ВМ:

      ```bash
      openstack server set --name <новое имя> <ID виртуальной машины>
      ```

   - Изменить тип ВМ:

      1. Получите список доступных шаблонов конфигурации и скопируйте ID шаблона:

         ```bash
         openstack flavor list --all
         ```

      2. Запустите изменение типа ВМ и дождитесь окончания процесса:

         ```bash
         openstack server resize --flavor <ID шаблона> <ID виртуальной машины>
         ```

</tabpanel>
</tabs>

## Присвоение тегов

Теги позволяют отфильтровать список виртуальных машин и быстрее найти нужную ВМ. Используйте существующие теги или создайте собственный тег и выберите для него цвет.

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Нажмите ![ ](/ru/assets/more-icon.svg "inline") для нужной ВМ.
4. Отметьте флажками нужные теги.
5. Для добавления нового тега нажмите **Создать новый тег**, введите его имя, выберите цвет и нажмите кнопку **Добавить тег**.

</tabpanel>

<tabpanel>

1. [Установите](/ru/tools-for-using-services/cli/openstack-cli) клиент OpenStack и пройдите аутентификацию в проекте, если этого еще не сделано.

2. Выполните нужную команду.

   - Вывести список тегов ВМ:

      ```bash
      nova server-tag-list <ID виртуальной машины>
      ```

   - Присвоить тег ВМ:

      ```bash
      nova server-tag-add <ID виртуальной машины> <тег>
      ```

   - Удалить тег у ВМ:

      ```bash
      nova server-tag-delete <ID виртуальной машины> <тег>
      ```

   - Удалить все теги у ВМ:

      ```bash
      nova server-tag-delete-all <ID виртуальной машины>
      ```

</tabpanel>
</tabs>

## {heading(Установка и изменение пароля)[id=password]}

В образах VK Cloud (кроме Bitrix) учетная запись `root` заблокирована в целях безопасности и добавлена учетная запись для использования по умолчанию.

Имя учетной записи по умолчанию вы можете посмотреть в списке ниже или в окне установки пароля.

<details>
<summary>Список учетных записей по умолчанию для разных ОС</summary>

| Операционная система | Имя пользователя |
| ---                  | ---              |
| AlmaLinux            | almalinux        |
| ALT Linux            | altlinux         |
| Astra Linux          | astra            |
| Bitrix               | root             |
| CentOS               | centos           |
| Debian               | debian           |
| Fedora               | fedora           |
| FreeBSD              | freebsd          |
| openSUSE             | opensuse         |
| Ubuntu               | ubuntu           |
| РЕД ОС               | redos            |
| Windows              | Admin            |

</details>

Пароль учетной записи по умолчанию нужно установить самостоятельно при первой авторизации в OC. Установленный пароль можно будет изменить.

Условия для установки пароля:

- виртуальная машина запущена и процесс загрузки ОС завершился;
- установлен и запущен гостевой агент QEMU (состояние — `running`).

<info>

В виртуальных машинах, созданных из образа VK Cloud, гостевой агент QEMU есть по умолчанию.

</info>

Команда для проверки состояния гостевого агента QEMU:

<tabs>

<tablist>
<tab>Windows</tab>
<tab>Linux</tab>
</tablist>

<tabpanel>

```bash
sc query qemu-ga
```

</tabpanel>

<tabpanel>

```bash
systemctl status qemu-guest-agent
```

</tabpanel>

</tabs>

<tabs>

<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Установите пароль одним из способов.

    - Через контекстное меню:

        1. В списке виртуальных машин нажмите ![ ](/ru/assets/more-icon.svg "inline") для нужной ВМ.
        1. Выберите пункт **Установить пароль**.
        1. Введите новый пароль или нажмите кнопку **Сгенерировать**.
        1. Нажмите кнопку **Задать пароль**.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация** или на вкладку **Консоль**.
        3. Над таблицей с параметрами ВМ или над окном с консолью нажмите кнопку **Установить пароль**.
        4. Введите новый пароль или нажмите кнопку **Сгенерировать**.
        5. Нажмите кнопку **Задать пароль**.

</tabpanel>

<tabpanel>

1. [Установите](/ru/tools-for-using-services/cli/openstack-cli) клиент OpenStack и пройдите аутентификацию в проекте, если этого еще не сделано.

2. Установите пароль:

   ```bash
   openstack server set --root-password <ID виртуальной машины>
   ```

</tabpanel>

</tabs>

<info>

Пароль должен быть длиной от 8 символов и содержать буквы латинского алфавита, цифры и спецсимволы `!`, `"`, `#`, `$`, `%`, `&`, `(`, `)`, `*`, `+`, `,`, `-`, `.`, `:`, `;`, `<`, `=`, `>`, `?`, `@`, `[`, `]`, `^`, `_`, `` ` ``, `{`, `}`, `~`.

</info>

## Восстановление пароля

Восстановление пароля, сгенерированного для пользователя по умолчанию, доступно только для виртуальных машин Windows, созданных в приватной сети. Чтобы получить пароль, необходим приватный ключ ключевой пары, выбранной при создании ВМ.

<warn>

Если после создания ВМ пароль был изменен или ВМ была создана во внешней сети, [установите новый пароль](#password).

</warn>

<tabs>

<tablist>
<tab>Личный кабинет</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
2. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
3. Откройте окно получения пароля одним из способов.

    - Через контекстное меню:

        1. В списке виртуальных машин нажмите ![ ](/ru/assets/more-icon.svg "inline") для нужной ВМ.
        3. Выберите пункт **Получить пароль**.

    - На странице виртуальной машины:

        1. В списке виртуальных машин нажмите на имя ВМ, состояние которой необходимо изменить.
        2. На странице ВМ перейдите на вкладку **Общая информация**.
        3. Над таблицей с параметрами ВМ нажмите кнопку **Еще**.
        4. Выберите **Получить пароль**.

4. В открывшемся окне нажмите **Файл приватного ключа** или вставьте содержимое ключа в поле **Приватный ключ**.
5. Нажмите кнопку **Расшифровать пароль**.
6. В окне появится поле **Пароль**. Скопируйте пароль, нажав значок в поле.

</tabpanel>

</tabs>

## Восстановление доступа к ВМ по ключу

Для восстановления доступа к виртуальной машине Linux по SSH с использованием ключевой пары необходимо знать пароль пользователя ОС.

1. Получите публичный ключ.

   - Если утрачен файл с публичным ключом, перейдите в директорию с файлом приватного ключа и выполните команду:

      ```bash
      ssh-keygen -y -f <имя файла с приватным ключом> > <имя файла с публичным ключом>
      ```

   - Если утрачен файл с приватным ключом, [создайте новую ключевую пару](/tools-for-using-services/vk-cloud-account/service-management/account-manage/keypairs#sozdanie_klyuchevoy_pary).

2. Создайте ссылку на файл с публичным ключом.

   1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
   2. Перейдите в раздел **Объектное хранилище → Бакеты**.
   3. Используйте существующий бакет или [создайте новый](/ru/storage/s3/service-management/buckets/create-bucket).
   4. [Добавьте файл](/ru/storage/s3/service-management/objects/upload-object) с публичным ключом в бакет.
   5. [Включите доступ](/ru/storage/s3/service-management/objects/manage-object#predostavlenie_dostupa_k_obektu) по ссылке к этому файлу.
   6. Скопируйте ссылку на файл с публичным ключом.

3. Загрузите публичный ключ на виртуальную машину.

   1. Перейдите в раздел **Облачные вычисления → Виртуальные машины**.
   2. В списке виртуальных машин нажмите на имя нужной ВМ.
   3. На странице ВМ перейдите на вкладку **Консоль**.
   4. Используйте имя пользователя по умолчанию и пароль для входа в ОС ВМ.
   5. Скачайте файл с публичным ключом:

      ```bash
      wget <ссылка на файл с публичным ключом>
      ```

   6. Скопируйте публичный ключ в файл `authorized_keys`:

      ```bash
      cat <файл с публичным ключом> >> ~/.ssh/authorized_keys
      ```

4. Проверьте возможность доступа по ключу.

   1. Перейдите в терминал компьютера, на котором хранится приватный ключ.
   2. Подключитесь к ВМ по SSH:

      ```bash
      ssh -i <путь к файлу с приватным ключом> <логин>@<внешний IP-адрес ВМ>
      ```
## {heading(Подключение диска к ВМ)[id=mount_disk]}

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Перейдите в раздел **Облачные вычисления → Виртуальные машины**. 
1. Нажмите на имя ВМ, которой нужно подключить диск.
1. Перейдите на вкадку **Диски**.   
1. Подключите диск к ВМ:

   <tabs>
   <tablist>
   <tab>Существующий диск</tab>
   <tab>Новый диск</tab>
   </tablist>
   <tabpanel>

   1. Нажмите кнопку **Подключить диск**.
   1. В открывшемся окне выберите из списка диск, который нужно подключить к ВМ, и нажмите кнопку **Подключить диск**.

   </tabpanel>
   <tabpanel>

   1. Нажмите кнопку **Создать диск**.
    
    {include(/ru/_includes/_disk_params.md)[tags=vm]}

   1. Нажмите кнопку **Создать диск**.

   </tabpanel>
   </tabs>
</tabpanel>

<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/tools-for-using-services/cli/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/tools-for-using-services/cli/openstack-cli#3_proydite_autentifikaciyu) в проекте.

1. [Создайте диск](/ru/computing/iaas/service-management/volumes#create_disk), если он еще не создан. Сохраните его ID.

1. [Подключите диск](/ru/computing/iaas/service-management/volumes#mount_disk) к ВМ.

</tabpanel>
</tabs>

<info>

Создание диска без привязки ВМ описано в разделе [Диски](/ru/computing/iaas/service-management/volumes).

</info>

## Просмотр журнала событий

Журнал событий содержит информацию об изменении состояния ВМ и о действиях пользователя.

<tabs>

<tablist>
<tab>OpenStack CLI</tab>
</tablist>

<tabpanel>

1. [Установите](/ru/tools-for-using-services/cli/openstack-cli) клиент OpenStack и пройдите аутентификацию в проекте, если этого еще не сделано.

2. Выполните нужную команду.

   - Просмотреть журнал событий (расширенный формат):

      ```bash
      openstack server event list --long <ID виртуальной машины>
      ```

   - Просмотреть журнал событий (краткий формат):

      ```bash
      openstack server event list <ID виртуальной машины>
      ```

   - Используйте ID события из колонки **Request ID**, чтобы вывести подробную информацию о событии:

      ```bash
      openstack server event show <ID виртуальной машины> <ID события>
      ```

Примеры событий:

- `start` / `stop` — запуск / остановка ВМ;
- `resize` / `confirmResize` — запуск изменения типа ВМ / подтверждение;
- `extend_volume` — увеличение размера диска;
- `create` — создание ВМ;
- `live-migration` — миграция ВМ.

</tabpanel>

</tabs>
