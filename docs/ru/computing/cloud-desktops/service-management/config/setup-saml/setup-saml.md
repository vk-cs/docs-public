Сервис Cloud Desktop поддерживает два способа аутентификации пользователей при подключении к удаленным рабочим столам:

- Аутентификация с помощью службы каталогов пользователей AD или LDAP. Используется по умолчанию.
- Двухфакторная аутентификация с помощью сервиса [SAML](https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language).

Одновременно для всех рабочих столов сервиса Cloud Desktop используется только один из способов аутентификации пользователей. При необходимости между способами аутентификации можно переключаться. При этом не потребуется повторной настройки других компонентов сервиса: сети, подсистемы удаленного доступа к рабочим столам и подключения к каталогу пользователей.

Чтобы использовать сервис аутентификации SAML в Cloud Desktop, выполните подготовительные действия:

1. [Настройте](../setup-ldap) службу каталогов пользователей AD или LDAP.
1. Подключите поставщика удостоверений SAML к тому же домену, что и служба каталогов.
1. Подготовьте поставщика удостоверений SAML для интеграции с сервисом Cloud Desktop. Порядок настройки зависит от выбранного SAML-провайдера.

Чтобы настроить двухфакторную аутентификацию с помощью сервиса SAML:

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Перейдите в раздел **Cloud Desktop** → **Настройки сервиса**.
1. (Опционально) На вкладке **SAML** включите опцию **Включить SAML**.

    Если опция отключена, то аутентификация пользователей будет выполняться с помощью службы каталогов AD или LDAP.

1. На вкладке **SAML** задайте параметры:

    - **ID клиента**: укажите уникальный идентификатор клиентского приложения в сервисе аутентификации SAML.
    - **URL метаданных**: укажите URL-адрес, по которому находится XML-файл с метаданными для SAML-интеграции.
    - **Проверка SSL**: включите опцию, чтобы проверять всю цепочку сертификатов на валидность и отсутствие в списках отзыва. При отключенной опции будет проверяться только наличие SSL-сертификата.  
    - **Тип Биндинга**: выберите способ отправки ответа на запрос аутентификации сервисом SAML: `HTTP-Redirect` или `HTTP-POST`.
    - **Response Binding Type**: выберите способ обратного перенаправления пользователя на сервис, запросивший SAML-авторизацию: `HTTP-Redirect` или `HTTP-POST`.
    - **Формат Name ID**: выберите, какой формат NameID (идентификаторов имен) будет использоваться для их сопоставления у поставщиков удостоверений и поставщиков услуг. Поддерживаются варианты:

        - `Email address`: NameID совпадает с адресом электронной почты пользователя.
        - `Persistent`: предоставленный NameID регистрируется в сервисе SAML и используется для нескольких сеансов.
        - `Transient`: сервис SAML идентифицирует пользователя с помощью предоставленного NameID и дает ему доступ, который действует только для одного сеанса.
        - `Unspecified`: формат NameID указывается непосредственно в запросе на SAML-аутентификацию.

    - **Group Attr Name**: укажите тип атрибута пользователя, который будет возвращаться сервисом SAML и на основании которого система будет принимать решение о предоставлении доступа. Тип атрибута может быть любым. Обычно указывается значение `Group`, т.е. доступ предоставляется в зависимости от того, к какой группе принадлежит пользователь.

1. Нажмите кнопку **Сохранить**.
