В сетевую конфигурацию сервиса Cloud Desktop входят:

- сеть для размещения служебных ВМ инфраструктуры сервиса;
- одна или несколько сетей для подключения пулов рабочих столов.

Все эти сети подключаются к одному и тому же маршрутизатору с выходом в интернет. Допускается размещение в одной и той же сети служебных ВМ и любого количества пулов рабочих столов.

Поддерживаются автоматический и ручной режимы настройки сетевой конфигурации. Режим выбирается на этапе [настройки сети](../../instructions/config/setup-net) для инфраструктуры сервиса и может быть изменен до момента, когда вы впервые запустите создание пула рабочих столов. После этого изменить режим настройки сетей сервиса будет нельзя.

### {heading(Автоматическая настройка сетей)[id=automatic_net_setup]}

При настройке сети в автоматическом режиме в сетевых настройках сервиса Cloud Desktop указываются:

- маршрутизатор с выходом в интернет, не привязанный ни к каким сетям;
- диапазон IP-адресов нужного объема.

Вместе с инстансом Cloud Desktop автоматически создается сеть, где будут размещены все ВМ инстанса: и служебные ВМ, и пулы рабочих столов.

### {heading(Ручная настройка сетей)[id=manual_net_setup]}

При ручной настройке можно создавать различные сетевые конфигурации:

- использовать одну и ту же сеть для подключения служебных ВМ и любого количества пулов рабочих столов, как в автоматическом режиме;
- создавать отдельную сеть для служебных ВМ и отдельные сети для каждого пула;
- настраивать любые другие варианты.

Сеть для размещения служебных ВМ указывается при [настройке инфраструктуры сервиса](../../instructions/config/setup-net), сети для пулов рабочих столов — при [создании пула](../../instructions/desktops-pool/add).

### {heading(Требования к числу портов)[id=ports_number]}

При ручной настройке необходимо самостоятельно контролировать, что выполняются требования к количеству свободных портов в сетях:

- Сеть для служебных ВМ должна иметь как минимум 16 свободных портов.
- В сети пула должно быть не меньше свободных портов, чем:

  - минимальное количество рабочих столов, если пул персонализированный;
  - сумма минимального количества рабочих столов и количества рабочих столов в горячем резерве, если пул сессионный.

  Рекомендованное количество свободных портов равняется максимальному числу рабочих столов в пуле, по одному порту на каждый рабочий стол.

- Если сеть используется для нескольких компонентов сервиса, например для служебных ВМ и для пула, нужное число портов должно рассчитываться как сумма требований для этих компонентов.

Количество *P* свободных портов рассчитывается по формуле:

{formula}
P = 2^{32-M}-C-2
{/formula}

Здесь *M* — маска подсети, *C* — количество уже созданных портов.

{note:warn}

Если сети используются не только для инстанса Cloud Desktop, но и для других нужд, количество свободных портов в них с течением времени может меняться. При нехватке портов рабочие столы будут создаваться с ошибкой.

{/note}
