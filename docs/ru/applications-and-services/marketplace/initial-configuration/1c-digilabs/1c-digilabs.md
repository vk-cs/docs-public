Вы можете перенести свою систему 1С в облачную инфраструктуру VK Cloud и далее работать с ней в высоконагруженном режиме без рисков падения производительности, недоступности сервиса или потери данных.

Возможности сервиса:

- использование высокопроизводительной отказоустойчивой инфраструктуры для хранения данных и работы приложений 1С;
- гибкое масштабирование используемой инфраструктуры: процессорных мощностей, объема оперативной памяти и дискового пространства;
- эффективный мониторинг работы как информационных баз, так и инфраструктуры в целом.

Пройдя все шаги инструкции, вы:

1. В автоматизированном режиме создадите виртуальные машины для размещения на них вашей информационной базы данных 1С.
1. Импортируете информационную базу 1С в облачную инфраструктуру.
1. Подключите базу, размещенную на облачной инфраструктуре, к клиентскому приложению системы 1С:Предприятие.
1. (Опционально) Выполните вход в интерфейс ПО Алькир.

<info>
Облачная инфраструктура будет развернута на базе серверов с ОС Linux и СУБД PostgreSQL. Использование серверов с ОС Windows и СУБД MS SQL находится на стадии тестирования.
</info>

Используя сервис Размещение высоконагруженных 1С в облаке, вы соглашаетесь с лицензионным соглашением [Marketplace](/ru/additionals/start/legal/marketplace), а также с условиями использования [программных продуктов Фирмы 1С](https://v8.1c.ru/price/#fe26f071-7409-11e6-853d-0050569f2de3) и (опционально) [программного обеспечения Алькир](https://digilabs.ru/#buyOptions).

## Подготовительные шаги

1. [Зарегистрируйтесь](/ru/additionals/start/account-registration) в VK Cloud.
1. [Создайте](/ru/networks/vnet/operations/manage-net) сеть и подсеть, где будут размещены виртуальные машины облачной инфраструктуры.
1. В [настройках подсети](/ru/networks/vnet/operations/manage-net#redaktirovanie_podseti) отключите опцию **Приватный DNS**.
1. Запросите доступ к сервису и образам ВМ для развертывания инфраструктуры в [технической поддержке](/ru/contacts).
1. Сделайте полную резервную копию вашей информационной базы 1С. На компьютере с ОС Linux используйте для этого утилиту [pg_dump](https://postgrespro.ru/docs/postgrespro/14/app-pgdump).

<warn>
Не архивируйте и не изменяйте каким-либо иным образом файл резервной копии перед импортом в облачную инфраструктуру.
</warn>

## 1. Разверните облачную инфраструктуру для размещения системы 1С

1. В [личном кабинете VK Cloud](https://msk.cloud.vk.com/app/) перейдите в раздел **Магазин приложений**.
1. На карточке сервиса **Размещение высоконагруженных 1С в облаке** нажмите кнопку **Подробнее**.
1. На странице сервиса нажмите кнопку **Подключить** или перейдите на вкладку **Тарифные планы**.
1. Выберите тариф с учетом количества потенциальных пользователей:

   - **Старт 0+**: 0–50 пользователей;
   - **Старт 50+**: 50–100 пользователей;
   - **Старт 100+**: 100–500 пользователей;
   - **Старт 500+**: больше 500 пользователей.

1. Задайте параметры на странице настройки сервиса:

   - **Версия платформы 1С**: выберите из списка версию платформы 1С. Версия не может быть ниже той, которую вы используете.
   - **Размер базы данных**: укажите размер информационной базы 1С, которая будет импортирована в облачную инфраструктуру. Округлите значение в большую сторону до целого количества гигабайтов.
   - **Название базы 1С**: укажите название информационной базы 1С, которая будет создана на облачной инфраструктуре. В названии можно использовать только заглавные и строчные латинские буквы, цифры, символы `-` и `_`.
   - **Опубликовать базу на серверах приложений 1С**: включите опцию, чтобы сделать облачную базу доступной через браузер. В противном случае она будет доступна только через клиентское приложение 1С.
   - **Установка и подключение ПО "Алькир"**: включите опцию, чтобы использовать [ПО Алькир](https://digilabs.ru/#aboutUs) в вашей облачной системе 1С. В облачную инфраструктуру будет добавлен дополнительный сервер, на котором автоматически будет установлена и настроена лицензированная копия ПО Алькир.
   - **Сеть**: выберите из списка сеть и подсеть, где будут размещены виртуальные машины облачной инфраструктуры.

1. Нажмите кнопку **Следующий шаг**.
1. На странице подтверждения проверьте итоговые параметры тарифа и нажмите кнопку **Подключить тариф**.

    Начнется развертывание облачной инфраструктуры и откроется страница свойств сервиса. Статус процесса будет отображаться также в разделе **Магазин приложений** → **Мои сервисы**. В разделе **Облачные вычисления** → **Виртуальные машины** можно отслеживать прогресс развертывания виртуальных машин для размещения системы 1С.

    После успешного развертывания на зарегистрированную в VK Cloud почту придут сообщения:

    - уведомление об успешном развертывании сервиса со ссылкой на инстанс сервиса в личном кабинете VK Cloud;
    - письмо с одноразовой ссылкой на данные для доступа к сервису;
    - уведомление о начале конфигурирования кластера 1С и СУБД.

1. Пройдите в письме по одноразовой ссылке и скопируйте данные для импорта информационной базы 1С в удаленное хранилище S3:

   - `instance_pid` — уникальный идентификатор клиента для сервиса Размещение высоконагруженных 1С в облаке;
   - `instance_uuid` — идентификатор вашего инстанса сервиса;
   - `s3_access_key` — идентификатор ключа доступа к [сервису AWS](https://aws.amazon.com/ru/) (AWS Access Key ID);
   - `s3_name` — имя бакета в хранилище S3;
   - `s3_secret_key` — секретный ключ доступа к сервису AWS (AWS Secret Access Key).

<info>

Для проверки работоспособности системы 1С на облачный кластер 1С будет установлена демонстрационная лицензия. Чтобы заменить ее на свою собственную лицензию 1С, после проверки обратитесь в [техподдержку](/ru/contacts/).

</info>

## 2. Импортируйте информационную базу 1С в облачную инфраструктуру

<warn>
Прежде чем приступить к импорту, дождитесь уведомления о завершении конфигурирования кластера 1С и СУБД.
</warn>

Порядок действий зависит от операционной системы компьютера, на котором сохранена резервная копия вашей информационной базы 1С.

<tabs>
<tablist>
<tab>Windows</tab>
<tab>Linux</tab>
</tablist>
<tabpanel>

1. Установите и настройте приложение AWS CLI.
   1. Установите [AWS CLI](https://awscli.amazonaws.com/AWSCLIV2.msi).
   1. Запустите приложение Windows PowerShell и проверьте успешность установки, запросив версию AWS CLI:

      ```shell

      aws.exe --version

      ```

      Ожидаемый результат:

      ```txt

      aws-cli/1.32.20 Python/3.8.10 Windows/10 botocore/1.34.20

      ```

   1. Для настройки AWS CLI запустите команду:

      ```shell
      
      aws.exe configure

      ```

   1. Введите данные, полученные в письме:

      - **AWS Access Key ID**: значение `s3_access_key`;
      - **AWS Secret Access Key**: значение `s3_secret_key`.

      Строки **Default region name** и **Default output format** оставьте пустыми, нажав клавишу *Enter*.

      Пример выполнения команды:

      ```txt

      PS C:\Windows\system32> aws.exe configure 
      AWS Access Key ID [None]: s3****p 
      AWS Secret Access Key [None]: 2lh*******************sTGqUG 
      Default region name [None]: 
      Default output format [None]:

      ```

      <info>

      Команда создаст файл `C:\Users\<имя пользователя>\.aws\credentials` и сохранит в нем ключи доступа, чтобы их не приходилось вводить заново при каждом обращении к AWS.

      </info>

1. Загрузите файл резервной копии базы 1С в удаленное хранилище S3, выполнив команду:

    ```shell

    aws s3 cp <путь_к_локальному_файлу> s3://<имя_бакета> --endpoint-url http://hb.vkcs.cloud

    ```

    Здесь:

    - `<путь_к_локальному_файлу>` — полный путь к файлу резервной копии в SQL-формате на вашем компьютере, например: `H:/SQLDumps/todaydump.sql`;
    - `<имя_бакета>` — имя бакета в хранилище S3, полученное в письме.

    Пример:

    ```shell

    aws s3 cp H:/SQLDumps/todaydump.sql s3://s3_backet_name --endpoint-url http://hb.vkcs.cloud

    ```

    Вывод при успешной операции:

    ```txt

    upload: ..H:/SQLDumps/todaydump.sql to s3://s3_backet_name/todaydump.sql

    ```

1. Запустите развертывание базы 1С из резервной копии в хранилище S3.
   1. Создайте файл сценария `start_import.ps1` со следующим содержимым:

      ```txt

      $instance_pid = Read-Host -Prompt 'instance_pid'
      $instance_uuid = Read-Host -Prompt 'instance_uuid'
      $s3_backup_path = Read-Host -Prompt 's3_backup_name'
      $body = @{"s3_backup_path"="$s3_backup_path"; "instance_pid"="$instance_pid"; "instance_uuid"="$instance_uuid"}
      Invoke-RestMethod -Method 'Post' -Uri https://vk-api.digilabs.ru/v1/infra/vk/db-import -Body ($body|ConvertTo-Json) -ContentType "application/json" -Headers @{'user-agent' = 'vscode-restclient'}

      ```

   1. Запустите сценарий `start_import.ps1`, открыв контекстное меню файла и выбрав **Выполнить с помощью PowerShell**.

      Если будет предложено изменить политику выполнения сценариев, приостановите политику (вариант `S`) и повторите запуск.

   1. Введите запрашиваемые данные:

      - **instance_pid**: значение `instance_pid`, полученное в письме;
      - **instance_uuid**: значение `instance_uuid`, полученное в письме;
      - **s3_backup_name**: имя резервной копии базы (путь указывать не нужно).

      Начнется импорт вашей базы 1С в облачную инфраструктуру. Вам на почту придет соответствующее оповещение.

</tabpanel>
<tabpanel>

Порядок импорта информационной базы описан на примере ОС Ubuntu 22.04 LTS. Дистрибутив этой версии Ubuntu по умолчанию включает пакеты `glibc`, `groff` и `less`, которые используются в приложении AWS CLI версии 2. Если у вас другая ОС, убедитесь, что эти пакеты установлены.

1. Установите и настройте приложение AWS CLI.

   1. Убедитесь, что пользователь, от имени которого вы выполняете действия, имеет права `sudo`.
   1. Установите пакет `unzip`, если он не установлен:

      ```bash

      sudo apt install unzip

      ```
   1. Последовательно выполните команды:

      ```bash

      curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
      unzip awscliv2.zip
      sudo ./aws/install

      ```

   1. Проверьте корректность установки приложения, запросив его версию:

      ```bash

      /usr/local/bin/aws --version

      ```

      Вывод при успешной операции:

      ```txt

      aws-cli/2.15.11 Python/3.11.6 Linux/5.15.133.1-microsoft-standard-WSL2 exe/x86_64.ubuntu.22 prompt/off

      ```

   1. Для настройки AWS CLI запустите команду:

      ```bash

      /usr/local/bin/aws configure

      ```

   1. Введите данные, полученные в письме:

      - **AWS Access Key ID**: значение `s3_access_key`;
      - **AWS Secret Access Key**: значение `s3_secret_key`.

      Строки **Default region name** и **Default output format** оставьте пустыми, нажав клавишу *Enter*.

      Пример выполнения команды:

      ```txt

      root@ubuntu2204:~# /usr/local/bin/aws configure
      AWS Access Key ID [None]: s3*****p
      AWS Secret Access Key [None]: 2lh*******************sTGqUG
      Default region name [None]:
      Default output format [None]:

      ```

      <info>

      Команда создаст файл `~/.aws/credentials` и сохранит в нем ключи доступа, чтобы их не приходилось вводить заново при каждом обращении к AWS.

      </info>

1. Загрузите файл резервной копии базы 1С в удаленное хранилище S3, выполнив команду:

      ```bash

      /usr/local/bin/aws s3 cp <путь_к_локальному_файлу> s3://<имя_бакета> --endpoint-url http://hb.vkcs.cloud

      ```

      Здесь:

      - `<путь_к_локальному_файлу>` — полный путь к файлу резервной копии в SQL-формате на вашем компьютере, например: `/mnt/backups/SQLDumps/todaydump.sql`;
      - `<имя_бакета>` — имя бакета в хранилище S3, полученное в письме.

      Пример:

      ```bash

      /usr/local/bin/aws s3 cp /mnt/backups/SQLDumps/todaydump.sql s3://s3_backet_name --endpoint-url http://hb.vkcs.cloud

      ```

      Вывод при успешной операции:

      ```txt

      upload: ../mnt/backups/SQLDumps/todaydump.sql to s3://s3_backet_name/todaydump.sql

      ```

      У файла резервной копии базы 1С в хранилище S3 будет то же имя, что и на вашем компьютере.

1. Запустите развертывание базы 1С из резервной копии в удаленном хранилище S3.

   1. Создайте файл скрипта `start_import_linux.sh` со следующим содержимым:

      ```txt

      #!/bin/bash
      read -p "Введите имя файла бэкапа, загруженного в S3: " s3_backup_path
      read -p "Введите instance_pid, полученный в письме: " instance_pid
      read -p "Введите instance_uuid, полученный в письме: " instance_uuid
      curl --request POST \
        --url https://vk-api.digilabs.ru/v1/infra/vk/db-import \
        --header 'content-type: application/json' \
        --header 'user-agent: vscode-restclient' \
        --data "{\"s3_backup_path\": \"$s3_backup_path\",\"instance_pid\": \"$instance_pid\",\"instance_uuid\": \"$instance_uuid\"}"

      ```

   1. Запустите скрипт `start_import_linux.sh`:

      ```bash

      sudo sh start_import_linux.sh

      ```

   1. Введите запрашиваемые данные:

      - **Введите имя файла бэкапа, загруженного в S3**: имя резервной копии базы (путь указывать не нужно).
      - **Введите instance_pid, полученный в письме**: значение `instance_pid`, полученное в письме.
      - **Введите instance_uuid, полученный в письме**: значение `instance_uuid`, полученное в письме.

      Начнется импорт вашей базы 1С в облачную инфраструктуру. Вам на почту придет соответствующее оповещение.

</tabpanel>
</tabs>

## 3. Подключите облачную базу 1С к клиентскому приложению системы 1С:Предприятие

Клиентское приложение системы 1С:Предприятие для работы с облачной информационной базой 1С может быть установлено на виртуальной машине в VK Cloud или на компьютере в вашей корпоративной сети.

1. Дождитесь письма с оповещением об окончании импорта базы 1С.
1. В [личном кабинете VK Cloud]( https://msk.cloud.vk.com/app/) перейдите в раздел **Облачные вычисления** → **Виртуальные машины**.
1. Из списка виртуальных машин выберите те, имена которых начинаются с `ones-app`. Скопируйте имена или IP-адреса этих ВМ.
1. Выполните действия в зависимости от того, с какого устройства вы будете подключаться к облачной информационной базе 1С.

   <tabs>
   <tablist>
   <tab>ВМ в VK Cloud</tab>
   <tab>Локальный компьютер</tab>
   </tablist>
   <tabpanel>

   1. Если у вас нет ВМ для подключения к облачной информационной базе 1С, [создайте](/ru/base/iaas/instructions/vm/vm-create) ее. Параметры ВМ:

      - Операционная система: любая версия ОС Windows.
      - Остальные параметры: на свое усмотрение.

   1. Добавьте ВМ, с которой вы будете подключаться к облачной базе 1С, в ту же группу безопасности, что и серверы развернутой облачной инфраструктуры:

      1. Перейдите в раздел **Облачные вычисления** → **Виртуальные машины**.
      1. Откройте меню любого сервера инфраструктуры и выберите пункт **Настройка firewall**.
      1. Найдите в списке активную группу и запомните ее название.
      1. [Назначьте](/ru/networks/vnet/operations/secgroups#naznachenie_gruppy_pravil_na_instans) эту группу безопасности ВМ.

   1. [Подключитесь](/ru/base/iaas/instructions/vm/vm-connect/vm-connect-win) к ВМ.
   1. Установите на ВМ клиентское приложение системы 1С:Предприятие.

   </tabpanel>
   <tabpanel>

   1. Подключите компьютер с установленным клиентским приложением 1С к вашей корпоративной сети с выходом в интернет.
   1. [Создайте](/ru/networks/vnet/operations/manage-vpn) VPN-туннель между этим компьютером и кластером ВМ, на котором размещена облачная база 1С. Параметры туннеля:

      - **Local Endpoint**: подсеть, указанная на этапе [развертывания облачной инфраструктуры](/ru/applications-and-services/marketplace/initial-configuration/1c-digilabs#1_razvernite_oblachnuyu_infrastrukturu_dlya_razmeshcheniya_sistemy_1s).
      - **Remote Endpoint**: подсеть вашей корпоративной сети, в которую включен компьютер с установленным клиентским приложением 1С.
      - Остальные параметры: на свое усмотрение.

   </tabpanel>
   </tabs>

1. Запустите клиентское приложение 1С.

   Отобразится диалоговое окно с предложением подключить информационную базу.

1. Нажмите кнопку **Да**.

   Отобразится диалоговое окно добавления информационной базы/группы.

1. Выберите опцию **Добавление в список существующей информационной базы** и нажмите кнопку **Далее**.
1. Задайте параметры расположения базы 1С:

   - **Выберите тип расположения информационной базы**: выберите опцию **На сервере 1С:Предприятия**.
   - **Кластер серверов**: укажите через запятую без пробелов имена или IP-адреса виртуальных машин, скопированные ранее в личном кабинете VK Cloud.
   - **Имя информационной базы**: введите название базы 1С, которое вы указали при [подключении сервиса](/ru/applications-and-services/marketplace/initial-configuration/1c-digilabs#1_razvernite_oblachnuyu_infrastrukturu_dlya_razmeshcheniya_sistemy_1s) в личном кабинете VK Cloud.

1. Нажмите кнопку **Далее**.
1. В следующем диалоговом окне оставьте все параметры без изменений и нажмите кнопку **Готово**.
1. Нажмите кнопку **1С:Предприятие** и дождитесь окончания запуска информационной базы.

   Отобразится страница авторизации 1С:Предприятие.

1. Введите ваш логин и пароль пользователя 1С:Предприятие.

   Откроется начальная страница программы. Настройка облачной системы 1С завершена.

## 4. (Опционально) Выполните вход в интерфейс ПО Алькир

Вход в интерфейс ПО Алькир доступен, если при [подключении к сервису](/ru/applications-and-services/marketplace/initial-configuration/1c-digilabs#1_razvernite_oblachnuyu_infrastrukturu_dlya_razmeshcheniya_sistemy_1s) вы выбрали опцию **Установка и подключение ПО "Алькир"**.

1. В [личном кабинете VK Cloud]( https://msk.cloud.vk.com/app/) перейдите в раздел **Облачные вычисления** → **Виртуальные машины**.
1. Найдите в списке ВМ, имя которой начинается с `alkir-`, и скопируйте ее имя или IP-адрес.
1. Запустите браузер на устройстве, которое используется для подключения к облачной базе 1С, и перейдите по скопированному адресу.

   Откроется интерфейс ПО Алькир, подключенного к вашей облачной базе 1С.

## Удалите неиспользуемые ресурсы

Работающая инфраструктура сервиса тарифицируется. Если она вам больше не нужна:

- [Удалите](/ru/applications-and-services/marketplace/service-management/pr-instance-manage#udalenie_instansa_servisa) инстанс сервиса Размещение высоконагруженных 1С в облаке.
- [Удалите](/ru/base/iaas/instructions/vm/vm-manage#udalenie_vm) ВМ, созданную для подключения к облачной информационной базе 1С.
