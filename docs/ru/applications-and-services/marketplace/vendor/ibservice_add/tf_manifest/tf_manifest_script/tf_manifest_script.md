# {heading(Использование скриптов)[id=tf_manifest_script]}

Скрипты позволяют выполнить различные операции в процессе развертывания сервиса (например, синхронизировать узлы при объединении в кластер).

В процессе развертывания сервиса агент передает хеш выполненных скриптов в сервис управления конфигурациями. Это позволяет оценить текущее состояние ВМ с инстансом сервиса (какие скрипты выполнены на текущий момент) и привести его к состоянию, описанному в манифесте Terraform.

Агент передает сервису управления конфигурациями статус скриптов. Возможные статусы:

* `ok` — скрипт выполнен успешно.
* `running` — скрипт выполняется.
* `failed` — скрипт завершен с ошибкой. Просмотр логов агента описан в разделе {linkto(../../ibservice_upload/ibservice_upload_deploysystemtest/#agent_log)[text=%text]}.

   Если получен статус `failed`, система развертывания запустит процесс развертывания сервиса повторно. Повторные попытки могут занимать до 1,5 ч и могут быть отключены в файле `settings.yaml` (подробнее — в разделе {linkto(../tf_manifest_settings/#tf_manifest_settings)[text=%text]}).

Результаты выполнения скриптов можно передать в сервис управления конфигурациями в форматированном виде и использовать при выполнении других скриптов.

Чтобы использовать скрипты при развертывании сервиса:

1. Убедитесь, что в манифесте описана установка агента на ВМ. Если установка агента не описана, опишите ее (подробнее — в разделе {linkto(/ru/applications-and-services/marketplace/vendor/ivkcs/ivkcs_resources/ivkcs_user_data/#ivkcs_user_data)[text=%text]}).
1. Во входных переменных опишите содержимое скриптов. Поддерживаются языки Bash и Python.

   <info>

   Содержимое скриптов можно описать на следующем шаге без использования входных переменных.

   </info>
1. Опишите порядок и настройки выполнения скриптов. Используйте ресурс `ivkcs_agent_exec` или блок `locals`.

   Для каждого скрипта можно определить опции, описанные в разделе {linkto(/ru/applications-and-services/marketplace/vendor/ivkcs/ivkcs_resources/ivkcs_agent_exec/#ivkcs_agent_exec)[text=%text]} (например, тайм-аут выполнения, количество попыток выполнения скрипта до определения его статуса как `failed`).
1. Если требуется получить результаты скриптов, чтобы использовать их в выходных параметрах (подробнее — в разделе {linkto(../tf_manifest_output/#tf_manifest_output)[text=%text]}) или в других ресурсах манифеста, используйте источник данных `ivkcs_agent_script_result`.

<info>

Ресурсы и источники данных описаны в разделе [Справочник по провайдеру VK CS Infra (iVK CS)](../../../ivkcs).

</info>

В разделе {linkto(../tf_manifest_steps/#tf_manifest_example)[text=%text]} приведен пример манифеста с применением скриптов.
