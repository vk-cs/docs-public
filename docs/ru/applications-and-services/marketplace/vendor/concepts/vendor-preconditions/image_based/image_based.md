# {heading(Требования к image-based приложениям)[id=image_based]}

Image-based приложение должно соответствовать следующим требованиям:

* Поддерживает работу на виртуализации KVM в OpenStack.
* Поддерживает работу в рамках сетевых решений, предоставляемых облачной платформой.
* Нет паролей по умолчанию.
* Закрыты порты, которые не используются.
* Работает на любой конфигурации инфраструктуры, выбранной пользователем при подключении сервиса.
* Должно автоматически запускаться в случае перезапуска ВМ:

   * После мягкого перезапуска ВМ, при котором работа сервиса и процессов ОС была завершена корректно. Например, если пользователь перезагрузил ОС через SSH после обновлений.
   * После принудительного перезапуска ВМ, при котором работа сервиса и процессов ОС не была завершена корректно. Например, если произошел сбой в инфраструктуре облачной платформы и оркестратор инициировал перезагрузку ВМ.

* Тарификация сервиса должна соответствовать требованиям, приведенным в разделе {linkto(../billing/#billing)[text=%text]}.
* К сервису должна прилагаться документация:

   * Инструкция по развертыванию.
   * Инструкция по эксплуатации или руководство пользователя (опционально).

* Документация сервиса должна соответствовать версии сервиса.
* Документация сервиса должна быть достаточной, чтобы по прилагаемым инструкциям пользователь смог получить работающий инстанс сервиса.
* Образ сервиса должен соответствовать требованиям, приведенным в разделе {linkto(#image_based_req_image)[text=%text]}.

<info>

Рекомендуется протестировать сервис перед публикацией в {var(sys6)} и убедиться, что он работает корректно на инфраструктуре облачной платформы (подробнее в разделе — {linkto(../cloud_integration/#cloud_integration)[text=%text]}).

</info>

## {heading(Требования к образу сервиса)[id=image_based_req_image]}

Образ сервиса должен соответствовать следующим требованиям:

* Должен содержать программный пакет [Cloud-init](https://cloudinit.readthedocs.io/en/latest/).
* Если используется агент (подробнее — в разделе {linkto(#image_based_req_agent)[text=%text]}), должен содержать следующие программные пакеты:

   * Curl.
   * Systemd.

* Не должен содержать:

   * Чувствительных данных.
   * Истории bash-команд работы с образом.
   * Отладчиков.

* Требования к настройке ОС:

   * Должен быть установлен ssh-сервер, запускающийся при загрузке ОС.
   * Должен быть отключен Firewall.
   * Ядро Linux должно выводить логи загрузки ОС в консоль.
   * Не должно быть встроенных неизменяемых MAC-адресов сетевых устройств.

* Требования к ядру Linux:

   * Должны быть установлены следующие драйверы:

      * Virtio-net.
      * Virtio-blk.
      * Virtiofs.

   * Если ядро Linux собирается с нуля, то драйверы VirtIO должны быть включены.

Информация о создании образа, загрузке и публикации образа в облачной платформе приведена в разделе [Добавление image-based приложения в Магазин](../../../ibservice_add).

## {heading(Агент)[id=image_based_req_agent]}

Для image-based приложений используется агент — это программное обеспечение, устанавливаемое на ВМ в процессе развертывания сервиса. Основные функции:

* Выполняет скрипты.
* Контролирует выполнение скриптов.
* Позволяет использовать результаты выполнения скриптов при развертывании инстанса сервиса.
* Позволяет отправлять результаты выполнения скриптов пользователю.
* Позволяет настроить мониторинг и автовосстановление ВМ инстанса сервиса (отслеживание состояния ВМ и повторное развертывание ВМ, если она вышла из строя).

Более подробная информация об агенте приведена в разделе {linkto(../../../ibservice_add/ib_image_create/ib_image_agent#ib_image_agent)[text=%text]}.
