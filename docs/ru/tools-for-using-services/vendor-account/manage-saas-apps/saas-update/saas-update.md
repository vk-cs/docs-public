SaaS-приложение необходимо обновить, если в его тарифные планы вносятся изменения:

* изменяются параметры тарифных планов или опций;
* добавляются тарифные планы или опции;
* удаляются тарифные планы или опции.

В случае таких изменений обновите конфигурацию SaaS-приложения в Marketplace:

1. Отредактируйте JSON-файл `catalog_<ИМЯ_СЕРВИСА>.json` с описанием конфигурации сервиса.

   1. Чтобы сохранить доступ к текущей опубликованной ревизии сервиса в тестовых пространствах имен Marketplace, вставьте в JSON-файл дополнительную секцию для описания новой конфигурации сервиса.

      {cut(Структура дополнительной секции)}

      {include(/ru/_includes/_saas_add_update.md)[tags=service_config]}

      {/cut}

   1. Убедитесь, что в JSON-файле сохранены все секции с описанием опубликованных ревизий сервиса.

      {note:err}

      Удаление таких секций приведет к удалению этих ревизий. Удаление разрешено только для неопубликованных ревизий сервиса: тестовых или снятых с публикации.

      {/note}

   1. Убедитесь, что в новой конфигурации сервиса указана новая [ревизия сервиса](../../../vendor-account/reference/saas-apps-reference/saas-param). Если указанная ревизия сервиса уже загружена в Marketplace, сервис не будет обновлен.

   1. Если вы изменили параметры текущих тарифных планов, убедитесь, что в новой конфигурации сервиса указаны новые [ревизии планов](../../../vendor-account/reference/saas-apps-reference/saas-plan). Если указанные ревизии планов уже загружены в Marketplace, тарифные планы не будут обновлены.

1. Если вы добавили или удалили тарифные планы, отредактируйте файл `resources/plan_mapping.json` в директории брокера.

   {cut(Структура файла resources/plan_mapping.json)}

   ```json
   {
      "<ИМЯ_СЕРВИСА>": {
         "<ID_ПЛАНА>": <SAAS_ID_ПЛАНА>,
         "<ID_ПЛАНА>": <SAAS_ID_ПЛАНА>
      }
   }
   ```

   Здесь:

   * `<ИМЯ_СЕРВИСА>` — имя сервиса.
   * `<ID_ПЛАНА>` — ID тарифных планов, указанных в файле `catalog_<ИМЯ_СЕРВИСА>.json`.
   * `<SAAS_ID_ПЛАНА>` (формат `string`) — ID тарифных планов на стороне сервиса, соответствующих ID тарифных планов `<ID_ПЛАНА>`.

   Пример содержимого файла `plan_mapping.json`:

   ```json
   {
     "VKT": {
       "0dc54b75-XXXX-89d5a47eef71": 1,
       "312b628e-XXXX-080ab4ca3acb": 2,
       "e2ae1588-XXXX-3f5081a799a9": 3,
       "b54e7247-XXXX-7a9dccc22e7b": 4
     }
   }
   ```

   {/cut}

   Поскольку брокер  периодически передает в Marketplace список конфигураций сервиса, новая конфигурация автоматически попадет в тестовое пространство имен Marketplace.

   {note:err}

   Чтобы Marketplace мог своевременно получать текущую конфигурацию сервиса, брокер должен быть доступен круглосуточно.

   {/note}

1. Протестируйте новую ревизию сервиса в тестовом пространстве имен Marketplace.

   {include(/ru/_includes/_saas_add_update.md)[tags=test_service]}

1. При необходимости внесите изменения в конфигурацию новой ревизии сервиса:

   1. Перейдите в поддиректорию `resources` директории с брокером.
   1. Отредактируйте файлы `catalog_<ИМЯ_СЕРВИСА>.json` и `plan_mapping.json`.
   1. Повторите тестирование еще раз.

1. Если вы указали тестовые значения стоимости в новой ревизии на время тестирования и отладки, отредактируйте файл `catalog_<ИМЯ_СЕРВИСА>.json`, указав в нем реальные значения.

1. Опубликуйте новую ревизию сервиса в открытом пространстве имен Marketplace. Для этого отправьте письмо на [marketplace@cloud.vk.com](mailto:marketplace@cloud.vk.com). В письме укажите ID сервиса и его новую ревизию.

   Будет проведено модерирование конфигурации сервиса. После этого новая ревизия сервиса переместится из тестового пространства имен Marketplace в открытое, указанное в параметре `metadata` в [JSON-файле конфигурации сервиса](../../reference/saas-apps-reference/saas-param). Новая ревизия сервиса будет доступна всем пользователям, имеющим доступ в это открытое пространство имен.

   {note:warn}

   В открытых пространствах имен доступна только последняя опубликованная ревизия сервиса.

   {/note}

   Предыдущая опубликованная ревизия перейдет в тестовое пространство имен Marketplace. В тестовых пространствах имен сохраняются все неопубликованные ревизии, описанные в JSON-файле конфигурации сервиса.

   Ревизии сервиса, удаленные из конфигурации сервиса, не будут доступны ни в тестовых, ни в открытых пространствах имен Marketplace.

   Публикация новой ревизии не повлияет на уже существующие инстансы (тенанты/аккаунты) сервиса. Ревизия этих инстансов сервиса не изменится, даже если она удалена из конфигурации сервиса и более недоступна в Marketplace.
