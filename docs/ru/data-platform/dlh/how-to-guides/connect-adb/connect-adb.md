Добавление в архитектуру Data Lakehouse (DLH) отдельной аналитической БД позволяет выполнять быструю обработку входящего потока событий без необходимости сохранения данных в S3-хранилище. Такой БД может быть PostgreSQL, где оперативные данные поступают в виде потока сообщений или батчами, или [Cloud ClickHouse](/ru/data-platform/clickhouse).

Далее будет рассмотрен вариант конфигурации сервиса Data Lakehouse с аналитической базы данных на базе продукта ClickHouse.

Запросы данных в аналитическую БД выполняет сервис [Cloud Trino](/ru/data-platform/trino), поэтому развертывание конфигурации Data Lakehouse с аналитической БД включает предварительное развертывание базовой архитектуры сервиса, а также дополнительное подключение используемого экземпляра сервиса Cloud Trino к аналитической БД.

## Подготовительные шаги

[Разверните](../../quick-start) базовую архитектуру сервиса Data Lakehouse.

## 1. Разверните экземпляр сервиса ClickHouse

1. Перейдите в раздел **Data Platform → Экземпляры сервисов**.
1. Нажмите кнопку **Создать экземпляр**.
1. На шаге **Конфигурация**:

   1. Выберите тип сервиса `Cloud ClickHouse`.
   1. В поле **Версия** оставьте значение по умолчанию.
   1. Выберите конфигурацию `Кластер`.

1. Нажмите кнопку **Следующий шаг**.
1. На шаге **Параметры**:

   1. Задайте параметры экземпляра:

      - **Название**: укажите имя для экземпляра сервиса.
      - **Описание**: при необходимости добавьте описание.
      - **Название базы данных**: укажите имя базы данных, к которой Cloud ClickHouse будет подключаться.
      - **Назначить внешний IP**: включите опцию, чтобы экземпляр Cloud ClickHouse был доступен через интернет.
      - **Кластер Kubernetes**: выберите из выпадающего списка кластер, который указывали при [создании экземпляра сервиса Cloud Iceberg Metastore](/ru/data-platform/dlh/quick-start#create_iceberg_instance) на этапе развертывания базовой конфигурации.

   1. Выберите конфигурацию кластера `Базовая` и укажите один из шаблонов конфигурации:

      * `Малый с репликацией` – подходит для тестовой конфигурации.
      * `Средний с репликацией` – для PROD-кластера низкой нагрузки.
      * `2-шардовый с репликацией` – для PROD-кластера средней нагрузки.
      * `3-шардовый с репликацией` – для PROD-кластера высокой нагрузки.

1. Нажмите кнопку **Следующий шаг**.
1. На шаге **Обслуживание**:

    {include(/ru/_includes/_clickhouse.md)[tags=maintenance]}

1. Нажмите кнопку **Следующий шаг**.
1. На шаге **Учетные данные**:

   1. В поле **Логин** оставьте значение по умолчанию. Запишите логин администратора для доступа к Cloud ClickHouse, он понадобится вам позже.
   1. В поле **Пароль** нажмите кнопку **Сгенерировать**, чтобы сгенерировать пароль администратора. Сохраните пароль, он понадобится вам позже

        {note:warn}

        Возможность восстановления пароля не предусмотрена.

        {/note}

1. Нажмите кнопку **Создать**.

Дождитесь завершения операции создания экземпляра сервиса Cloud ClickHouse.

## 2. Настройте подключение к Cloud ClickHouse в Cloud Trino

[Добавьте](/ru/data-platform/trino/instructions/management#add_connect) новое подключение для источника `Clickhouse` в настройках экземпляра сервиса Cloud Trino, который был создан при развертывании базовой конфигурации. В параметрах подключения укажите данные экземпляра сервиса Cloud ClickHouse, созданного выше.
