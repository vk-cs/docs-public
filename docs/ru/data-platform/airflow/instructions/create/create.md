Вы можете создать экземпляр сервиса Cloud Airflow в одной из двух конфигураций:

{include(/ru/_includes/_airflow.md)[tags=conf]}

## {heading(Создание экземпляра сервиса в конфигурации Single)[id=single]}

{tabs}

{tab(Личный кабинет)}

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где нужно создать экземпляр сервиса.
1. Перейдите в раздел **Data Platform → Экземпляры сервисов**.
1. Нажмите кнопку **Добавить инстанс** или **Создать экземпляр**.
1. На шаге **Конфигурация**:

   1. Выберите тип сервиса `Cloud Airflow`.
   1. Выберите нужную версию сервиса.
   1. Выберите конфигурацию `Single`.
   1. Нажмите кнопку **Следующий шаг**.

1. На шаге **Параметры**:

   1. Задайте для экземпляра название и описание.
   1. Выберите кластер Kubernetes. В этот кластер [Cloud Containers](/ru/kubernetes/k8s) будет добавлен [worker-узел](/ru/kubernetes/k8s/concepts/architecture#topologii_klastera) для размещения экземпляра сервиса Cloud Airflow.

      Если нужного кластера нет в списке:

      1. Выберите пункт **Создать новый кластер**.
      1. Выберите сеть и подсеть для кластера из выпадающего списка **Сеть**.

         Если нужной сети нет в списке:

         1. Выберите пункт **Создать новую сеть**.
         1. Выберите нужную [SDN](/ru/networks/vnet/concepts/sdn): `Neutron` или `Sprut`.
         1. Задайте адрес подсети, например, `10.0.1.0/24`.

      1. Выберите [зону доступности](/ru/intro/start/concepts/architecture#az), где будет размещен узел кластера Cloud Containers.

   1. Задайте параметры в блоке **Worker**:

      1. Выберите [тип виртуальной машины](/ru/computing/iaas/concepts/vm/flavor) для узла из выпадающего списка.
      1. Выберите [тип диска](/ru/computing/iaas/concepts/data-storage/disk-types) для узла из выпадающего списка.
      1. Задайте [размер диска](/ru/computing/iaas/concepts/data-storage/volume-sla) для узла.

   1. Задайте параметры в блоке **PostgreSQL**:

      1. Выберите [тип виртуальной машины](/ru/computing/iaas/concepts/vm/flavor), на которой будет развернута БД PostgreSQL, из выпадающего списка.
      1. Выберите [тип диска](/ru/computing/iaas/concepts/data-storage/disk-types) из выпадающего списка.
      1. Задайте [размер диска](/ru/computing/iaas/concepts/data-storage/volume-sla).

   1. Нажмите кнопку **Следующий шаг**.

1. На шаге **Хранилище DAG Airflow** выберите источник подключения и укажите:

   {tabs}
   
   {tab(S3 Cloud)}
      
   - **Название бакета**: имя бакета, который вы хотите подключить в качестве хранилища DAG.
   - **Path** (необязательное поле): путь до бакета.

   {/tab}
   
   {tab(S3 External)}
   
   - **Название бакета**: имя бакета, который вы хотите подключить в качестве хранилища DAG.
   - **Endpoint**: URL-адрес вашего хранилища.
   - **Region** (необязательное поле): [регион](/ru/tools-for-using-services/account/concepts/regions), в котором расположено ваше хранилище.
   - **Path** (необязательное поле): путь до бакета.
   - **Access Key**: публичный ключ для доступа к хранилищу.
   - **Secret Key**: приватный ключ для доступа к хранилищу.

   {/tab}
   
   {/tabs}

1. Нажмите кнопку **Следующий шаг**.

1. На шаге **Учетные данные**:

   1. Придумайте логин администратора для доступа к Airflow. Требования к логину:

      - Допустимы только цифры, латинские буквы и спецсимвол `_`.
      - Первый символ — латинская буква любого регистра или `_`.
      - Недопустимы имена: `os_admin`, `root`, `dataplatform_moth`.

   1. Укажите электронную почту администратора.
   1. Укажите имя администратора.
   1. Укажите фамилию администратора.
   1. Придумайте или сгенерируйте пароль администратора.

      Требования к паролю:

      - не менее 8 символов;
      - должен содержать хотя бы одну заглавную и одну строчную букву латинского алфавита, хотя бы одну цифру и один из спецсимволов: `!`, `"`, `#`, `$`, `%`, `&`, `(`, `)`, `*`, `+`, `,`, `.`, `:`, `;`, `<`, `=`, `>`, `?`, `@`, `[`, `]`, `^`, `_`, `{`, `}`, `~`, `-`.

      {note:info}

      Утерянный пароль невозможно восстановить, но можно [поменять](../management#change_password) на новый.

      {/note}

   1. Нажмите кнопку **Создать**.

{/tab}

{/tabs}

## {heading(Создание экземпляра сервиса в конфигурации Кластер)[id=cluster]}

{tabs}

{tab(Личный кабинет)}

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где нужно создать экземпляр сервиса.
1. Перейдите в раздел **Data Platform → Экземпляры сервисов**.
1. Нажмите кнопку **Создать инстанс** или **Создать экземпляр**.
1. На шаге **Конфигурация**:

   1. Выберите тип сервиса `Cloud Airflow`.
   1. Выберите нужную версию сервиса.
   1. Выберите конфигурацию `Кластер`.
   1. Нажмите кнопку **Следующий шаг**.

1. На шаге **Параметры**:

   1. Задайте для экземпляра название и описание.
   1. Выберите кластер Kubernetes. В этот кластер [Cloud Containers](/ru/kubernetes/k8s) будет добавлен [worker-узел](/ru/kubernetes/k8s/concepts/architecture#topologii_klastera) для размещения экземпляра Cloud Airflow.

      Если нужного кластера нет в списке:

      1. Выберите пункт **Создать новый кластер**.
      1. Выберите сеть и подсеть для кластера из выпадающего списка **Сеть**.

         Если нужной сети нет в списке:

         1. Выберите пункт **Создать новую сеть**.
         1. Выберите нужную [SDN](/ru/networks/vnet/concepts/sdn): `Neutron` или `Sprut`.
         1. Задайте адрес подсети, например, `10.0.1.0/24`.

      1. Выберите [зону доступности](/ru/intro/start/concepts/architecture#az), где будет размещен узел кластера Cloud Containers.
   1. Настройте параметры узлов кластера, выбрав одну из опций:

      {tabs}
      
      {tab(Базовая)}
            
      Выберите один из готовых шаблонов с необходимым количеством CPU и RAM узлов кластера. [Шаблон конфигурации](/ru/computing/iaas/concepts/vm/flavor) и [тип диска](/ru/computing/iaas/concepts/data-storage/disk-types) для узлов кластера уже выбраны.

      При выборе любого шаблона экземпляр Cloud Airflow будет состоять из трех узлов с PostgreSQL и нескольких worker-узлов.

      {/tab}
      
      {tab(Продвинутая)}
      
      1. Задайте параметры в блоке **Worker**:

         1. Выберите [тип виртуальной машины](/ru/computing/iaas/concepts/vm/flavor) для узла из выпадающего списка.
         1. Выберите [тип диска](/ru/computing/iaas/concepts/data-storage/disk-types) для узла из выпадающего списка.
         1. Задайте [размер диска](/ru/computing/iaas/concepts/data-storage/volume-sla) для узла.
         1. Задайте значение общего количества worker-узлов. Минимальное значение — `2`.

      1. Задайте параметры в блоке **PostgreSQL**:

         1. Выберите [тип виртуальной машины](/ru/computing/iaas/concepts/vm/flavor), на которой будет развернут PostgreSQL, из выпадающего списка.
         1. Выберите [тип диска](/ru/computing/iaas/concepts/data-storage/disk-types) из выпадающего списка.
         1. Задайте [размер диска](/ru/computing/iaas/concepts/data-storage/volume-sla).
         1. Задайте значение общего количества узлов. Минимальное значение — `3`.

      {/tab}
      
      {/tabs}

   1. Нажмите кнопку **Следующий шаг**.

1. На шаге **DAG Airflow** задайте параметры для доступа к хранилищу S3:

   {tabs}
   
   {tab(S3 Cloud)}
      
   - **Название бакета**: имя бакета, который вы хотите подключить в качестве хранилища DAG.
   - **Path** (необязательное поле): путь до бакета.

   {/tab}
   
   {tab(S3 External)}
   
   - **Название бакета**: имя бакета, который вы хотите подключить в качестве хранилища DAG.
   - **Endpoint** URL-адрес вашего хранилища.
   - **Region** (необязательное поле): [регион](/ru/tools-for-using-services/account/concepts/regions), в котором расположено ваше хранилище.
   - **Path** (необязательное поле): путь до бакета.
   - **Access Key**: публичный ключ для доступа к хранилищу.
   - **Secret Key**: приватный ключ для доступа к хранилищу.

   {/tab}
   
   {/tabs}

   Нажмите кнопку **Следующий шаг**.

1. На шаге **Учетные данные**:
 
   1. Придумайте логин администратора для доступа к Airflow.

      Требования к логину:

      - Допустимы только цифры, латинские буквы и символ `_`.
      - Первый символ — латинская буква любого регистра или `_`.
      - Недопустимы имена: `os_admin`, `root`, `dataplatform_moth`.

   1. Укажите электронную почту администратора.
   1. Укажите имя администратора.
   1. Укажите фамилию администратора.
   1. Придумайте или сгенерируйте пароль администратора.

      Требования к паролю:

      - должен состоять как минимум из 8 символов;
      - должен содержать хотя бы одну заглавную и одну строчную букву латинского алфавита, хотя бы одну цифру и один из спецсимволов: `!`, `"`, `#`, `$`, `%`, `&`, `(`, `)`, `*`, `+`, `,`, `.`, `:`, `;`, `<`, `=`, `>`, `?`, `@`, `[`, `]`, `^`, `_`, `{`, `}`, `~`, `-`.

      {note:info}

      Утерянный пароль невозможно восстановить, но можно [поменять](../management#change_password) на новый.

      {/note}

   1. Нажмите кнопку **Создать**.

      Дождитесь завершения операции. Создание экземпляра сервиса Cloud Airflow в конфигурации **Кластер** может занять около часа.

{/tab}
   
{/tabs}