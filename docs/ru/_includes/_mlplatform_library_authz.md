{includetag(intro_part)}

Для использования большинства методов, которые предоставляет Python-библиотека Cloud ML Platform, необходимо выполнить авторизацию при помощи _токена доступа_.

Токены доступа (refresh-токены) имеют одну из следующих ролей, которые определяют их область действия:

- `Пользователь`. Токен с этой ролью позволяет использовать большинство методов, доступных в библиотеке.
- `Администратор`. Токен с этой ролью позволяет использовать все методы, доступные в библиотеке. Например, имея токен доступа с этой ролью, можно управлять другими токенами.

{/includetag}

{includetag(main_part)}

В зависимости от прав доступа, токен можно получить разными способами:

- через личный кабинет VK Cloud (обычно токен доступа с ролью `Администратор`);
- через библиотеку Cloud ML Platform.

## Создание токена доступа в личном кабинете

Если у пользователя есть доступ к личному кабинету VK Cloud, он самостоятельно может создать токен доступа и выбрать одну из двух ролей. Такой токен имеет неограниченное время действия.

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, в котором нужно создать токен.
1. Перейдите в раздел **ML Platform → Токены**.
1. Нажмите кнопку **Создать токен доступа**.
1. В открывшемся окне укажите параметры токена:

   - **Название**: может быть любым.
   - **Роль**: выбранная роль (`Пользователь` или `Администратор`).

1. Нажмите кнопку **Создать**.
1. В открывшемся окне скопируйте значение токена и сохраните его на своем устройстве. После закрытия окна восстановить значение токена будет невозможно. Если оно утеряно, создайте новый токен.
1. Нажмите кнопку **Готово**.

<err>

Не передавайте никому свой токен доступа.

</err>

## {heading(Создание токена доступа через библиотеку Cloud ML Platform)[id=create_token_console]}

Если у пользователя нет доступа к личному кабинету VK Cloud, токен доступа можно создать через библиотеку с помощью регистрационного токена:

1. Владелец токена доступа с ролью `Администратор` через библиотеку [создает регистрационный токен (register-токен)](#sozdanie_registracionnogo_tokena_b6cc872a) для пользователя. Он одноразовый и имеет ограниченное время жизни (TTL). В регистрационном токене задаются все параметры токена доступа: название, роль, время жизни.

2. Пользователь с помощью регистрационного токена через библиотеку [создает токен доступа (refresh-токен)](#sozdanie_tokena_dostupa_s_ispolzovaniem_registracionnogo_tokena_33331fb8) для авторизации при вызове методов библиотеки. Все параметры токена доступа были заданы администратором в регистрационном токене, изменить их нельзя.

### Создание регистрационного токена

Регистрационный токен создается только через библиотеку Cloud ML Platform.

<err>

Для простоты значение токена доступа указано в примере скрипта Python, а значение регистрационного токена выводится с помощью `print()`.

При работе в production-среде не оперируйте токенами в открытом виде. Используйте переменные среды окружения, хранилища секретов или другие инструменты для работы с чувствительными данными.

</err>

1. [Установите библиотеку](../install), если это еще не сделано.
1. [Создайте токен доступа](#sozdanie_tokena_dostupa_v_lichnom_kabinete) с ролью `Администратор`, если это еще не сделано.
1. Выполните скрипт Python:

   ```python
   from mlplatform_client import MLPlatform
   from mlplatform_client.serializers.auth import MLPTokenType
    
   ADMIN_REFRESH_TOKEN = "<значение токена доступа с ролью Администратор>"
    
   mlp = MLPlatform(ADMIN_REFRESH_TOKEN)

   register_token = mlp.create_register_token(
       client_name="<имя токена доступа>",
       access_ttl="<время жизни регистрационного токена>",
       refresh_ttl="<время жизни токена доступа>",
       token_type=<роль токена доступа>)

   print(register_token)
   ```

   Здесь:

   - `client_name`: имя токена доступа, который будет создан с помощью этого регистрационного токена.
   - `access_ttl`: время жизни регистрационного токена, например, `2h45m30s`. Регистрационный токен с истекшим сроком жизни не получится использовать для создания токена доступа.
   - `refresh_ttl`: время жизни токена доступа, например, `2h`. Если не указывать этот параметр, то токен доступа будет действовать бессрочно.

   - `token_type`: роль токена доступа:

     - значение `MLPTokenType.USER` соответствует роли `Пользователь`;
     - значение `MLPTokenType.ADMIN` соответствует роли `Администратор`.

   После выполнения этого скрипта будет выведено значение созданного регистрационного токена доступа.

1. Предоставьте этот регистрационный токен другому пользователю, чтобы он мог использовать этот токен для создания токена доступа с заданными параметрами.

### Создание токена доступа с использованием регистрационного токена

<err>

Для простоты значение регистрационного токена указано в примере скрипта Python, а значение токена доступа выводится с помощью `print()`.

При работе в production-среде не оперируйте токенами в открытом виде. Используйте переменные среды окружения, хранилища секретов или другие инструменты для работы с чувствительными данными.

</err>

1. [Установите библиотеку](../install), если это еще не сделано.
1. Убедитесь, что у вас есть регистрационный токен. Если его нет, то попросите владельца токена доступа с ролью `Администратор` [создать регистрационный токен](#sozdanie_registracionnogo_tokena_b6cc872a).
1. Выполните скрипт Python:

   ```python
   from mlplatform_client import MLPlatform
 
   REGISTER_TOKEN = "<значение регистрационного токена>"

   mlp = MLPlatform()
   refresh_token = mlp.create_refresh_token(REGISTER_TOKEN)
 
   print(refresh_token)
   ```

   После выполнения этого скрипта будет выведено значение созданного токена доступа.

   Параметры токена доступа (имя, роль и время жизни) определяются регистрационным токеном.

1. Скопируйте значение токена и сохраните его на своем устройстве.

<err>

Не передавайте никому свой токен доступа.

</err>

## Авторизация с помощью токена

<err>

Для простоты значение токена доступа указано в примере скрипта Python. При работе в production-среде не оперируйте токенами в открытом виде. Используйте переменные среды окружения, хранилища секретов или другие инструменты для работы с чувствительными данными.

</err>

1. Создайте токен доступа [через личный кабинет](#sozdanie_tokena_dostupa_v_lichnom_kabinete) или [через библиотеку Cloud ML Platform](#sozdanie_tokena_dostupa_cherez_biblioteku_cloud_ml_platform).

   В зависимости от того, какие методы планируется использовать, может потребоваться токен доступа с определенной ролью. В [справочнике методов библиотеки](../library-reference) указывается, какая роль должна быть у токена, чтобы вызвать конкретный метод.

1. Создайте объект класса MLPlatform и передайте в конструктор значение полученного токена.

   **Пример:**

   ```python
   from mlplatform_client import MLPlatform

   REFRESH_TOKEN = "<значение токена доступа>"
   mlp = MLPlatform(REFRESH_TOKEN)
   ```

Теперь вы можете вызывать нужные вам методы, пользуясь этим объектом. Указанный при создании объекта токен будет использован для авторизации при вызове метода.

Если авторизация была неуспешна, будет выведено похожее сообщение об ошибке:

- Если роль токена недостаточна для вызова метода:

  ```text
  mlplatform_client.core.exceptions.ForbiddenException: <Response [403]>. Info: {"status":403,"warnorCode":"ForbiddenException","warnorParams":{"field":"KtoTam token does not contain the following scopes: ['ml-platform:Manage']"}}
  ```

- Если у токена истекло время жизни:

  ```text
  mlplatform_client.core.exceptions.ForbiddenException: <Response [403]>. Info: {"status":403,"warnorCode":"ForbiddenException","warnorParams":{"field":"Forbidden"}}
  ```

## Получение списка токенов доступа

Можно получить только список токенов доступа. Список созданных регистрационных токенов не ведется.

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>Библиотека Cloud ML Platform</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, в котором находятся токены.
1. Перейдите в раздел **ML Platform → Токены**.

</tabpanel>
<tabpanel>

<err>

Для простоты значение токена доступа указано в примере скрипта Python.

При работе в production-среде не оперируйте токенами в открытом виде. Используйте переменные среды окружения, хранилища секретов или другие инструменты для работы с чувствительными данными.

</err>

1. [Установите библиотеку](../install), если это еще не сделано.
1. [Авторизуйтесь, используя токен доступа](#avtorizaciya_s_pomoshchyu_tokena) с ролью `Администратор`, если это еще не сделано.
1. Выполните скрипт Python:

   ```python
   from mlplatform_client import MLPlatform
 
   ADMIN_REFRESH_TOKEN = "<значение токена доступа с ролью Администратор>"
    
   mlp = MLPlatform(ADMIN_REFRESH_TOKEN)
   print(mlp.get_project_tokens_info())
   ```

</tabpanel>
</tabs>

## {heading(Получение информации о текущем токене доступа)[id=get_current_token_details]}

Получить информацию о токене доступа, который используется в настоящий момент, можно только через библиотеку Cloud ML Platform.

<tabs>
<tablist>
<tab>Библиотека Cloud ML Platform</tab>
</tablist>
<tabpanel>

<err>

Для простоты значение токена доступа указано в примере скрипта Python.

При работе в production-среде не оперируйте токенами в открытом виде. Используйте переменные среды окружения, хранилища секретов или другие инструменты для работы с чувствительными данными.

</err>

1. [Установите библиотеку](../install), если это еще не сделано.
1. [Авторизуйтесь, используя токен доступа](#avtorizaciya_s_pomoshchyu_tokena) с ролью `Пользователь` или `Администратор`, если это еще не сделано.
1. Выполните скрипт Python:

   ```python
   from mlplatform_client import MLPlatform

   REFRESH_TOKEN = "<значение токена доступа с ролью Пользователь или Администратор>"
   mlp = MLPlatform(REFRESH_TOKEN)

   token_info=mlp.who_am_i()
   print(token_info)
   ```

   Будет выведена информация о текущем используемом токене доступа. Пример вывода в случае успеха:

   ```txt
   Token my-user-token:
	        id: 8cdc3742-ХХХХ
	        type: USER
	        issuer_name: ХХХХ@example.ru
	        exp: None
   ```

</tabpanel>
</tabs>

## Удаление токена доступа

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>Библиотека Cloud ML Platform</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужный токен.
1. Перейдите в раздел **ML Platform → Токены**.
1. Нажмите ![ ](/ru/assets/more-icon.svg "inline") для нужного токена и выберите пункт **Удалить**.
1. Нажмите кнопку **Подтвердить**.

</tabpanel>
<tabpanel>

<err>

Для простоты значение токена доступа указано в примере скрипта Python.

При работе в production-среде не оперируйте токенами в открытом виде. Используйте переменные среды окружения, хранилища секретов или другие инструменты для работы с чувствительными данными.

</err>

1. [Установите библиотеку](../install), если это еще не сделано.
1. [Авторизуйтесь, используя токен доступа](#avtorizaciya_s_pomoshchyu_tokena) с ролью `Администратор`, если это еще не сделано.
1. [Получите список токенов доступа](#poluchenie_spiska_tokenov_dostupa) и определите имя токена, который нужно удалить.
1. Выполните скрипт Python:

   ```python
   from mlplatform_client import MLPlatform

   ADMIN_REFRESH_TOKEN = "<значение токена доступа с ролью Администратор>"
   REFRESH_TOKEN_NAME = "<имя токена доступа, который нужно удалить>"

   mlp = MLPlatform(ADMIN_REFRESH_TOKEN)
   mlp.delete_token(token_name=REFRESH_TOKEN_NAME)

   print("Token", REFRESH_TOKEN_NAME, "was deleted.")
   ```

   После выполнения этого скрипта выбранный токен доступа будет удален.

</tabpanel>
</tabs>

{/includetag}
