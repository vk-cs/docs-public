Вы можете создавать файловые хранилища, читать и записывать данные в них, подключать (монтировать) к инстансам и создавать снимки.

Файловые хранилища можно подключить к инстансам проекта по протоколам CIFS или NFS.

<info>

Файловые хранилища доступны только из виртуальных машин внутри проекта VK Cloud.

</info>

## Создание файлового хранилища

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где нужно создать файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**.
1. Нажмите кнопку **Создать хранилище** или **Создать**.
1. Задайте параметры файлового хранилища:
    * **Имя файлового хранилища**: может состоять только из латинских букв, цифр и символов `-`, `_` и `.`;
    * **Размер хранилища**: должен быть в пределах квоты, не меньше 10 ГБ и не больше 10000 ГБ;
    * **Протокол**: для доступа к хранилищу из ОС Windows выберите протокол CIFS, из Linux — NFS;
    * **Сеть**: выберите из предложенных или создайте новую. Для новой сети укажите также **Адрес подсети**;
    * **Сеть файлового хранилища**: выберите из предложенных или создайте новую.
1. Нажмите кнопку **Следующий шаг**.
1. (Опционально) Добавьте правила доступа к хранилищу:
    1. Нажмите на **Добавить новое правило**.
    1. Введите IP-адрес или адрес подсети источника.
    1. Выберите режим доступа.
    1. Нажмите кнопку **Добавить правило**.

   <info>

   Добавить правила доступа можно и после создания файлового хранилища.

   </info>

1. Нажмите **Добавить файловый сервер**.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

2. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

3. Создайте сеть для файлового хранилища, основанную на существующей приватной сети, выполнив команду:

    ```bash
    manila share-network-create --neutron-net-id <ID приватной сети> --neutron-subnet-id <ID подсети> --name <название сети хранилища>
    ```

4. Создайте файловое хранилище с помощью команды:

    ```bash
    manila create --share-network <ID сети файлового хранилища> <протокол> <размер>
    ```

    Здесь:
      * `<ID сети файлового хранилища>` — ID сети, созданной на предыдущем шаге.
      * `<протокол>` — для доступа к хранилищу из ОС Windows укажите протокол CIFS, из Linux — NFS.
      * `<размер>` — желаемый размер файлового хранилища. Должен быть в пределах квоты, не меньше 10 ГБ и не больше 10000 ГБ.

</tabpanel>
</tabs>

## Подключение файлового хранилища

Способ подключения файлового хранилища зависит от операционной системы и протокола, выбранного при создании хранилища.

### Windows

<info>

Инструкция приведена для Windows Server 2012 R2. О подключении в других версиях Windows читайте в документации разработчика.

</info>

#### NFS

Подключить NFS-хранилище в Windows можно с помощью Клиента для NFS. Это компонент Windows Server, который можно установить из интерфейса Диспетчера серверов или с помощью PowerShell:

<tabs>
<tablist>
<tab>Диспетчер серверов</tab>
<tab>PowerShell</tab>
</tablist>
<tabpanel>

1. Откройте Диспетчер серверов и в меню **Управление** выберите **Добавить роли и компоненты**.
1. Перейдите в раздел **Тип установки**, выберите опцию **Установка ролей и компонентов** и нажмите **Далее**.
1. Перейдите в раздел **Компоненты**, выберите в списке **Клиент для NFS**.
1. В том же списке раскройте опции **Средства удаленного администрирования серверов → Средства администрирования ролей → Средства файловых служб** и выберите **Службы для средств управления NFS**. Нажмите **Далее**.
1. Проверьте, что выбраны все необходимые компоненты, и нажмите **Установить**.
1. Дождитесь окончания установки и перезагрузите сервер.

</tabpanel>
<tabpanel>

1. Установите:

    * Клиент для NFS;
    * Службы для средств управления NFS.

    Воспользуйтесь Powershell-командой:

    ```powershell
    Install-WindowsFeature NFS-Client, RSAT-NFS-Admin
    ```

2. Дождитесь окончания установки и перезагрузите сервер.

</tabpanel>
</tabs>

Чтобы изменить настройки клиента, воспользуйтесь Диспетчером серверов:

   1. В меню **Средства** выберите **Службы для NFS**.
   1. Выберите **Клиент для NFS** и нажмите на иконку **Отобразить окно свойств**.
   1. Задайте нужные настройки.

Подключите NFS-хранилище с помощью команды, описанной в его [свойствах](#prosmotr_informacii_o_faylovom_hranilishche).

Команда для подключения хранилища выглядит так:

```bash
mount <Точка подключения> <Имя диска>:
```

Здесь:
  
* `<Точка подключения>` — адрес файлового хранилища, указанный в его описании;
* `<Имя диска>` — заглавная латинская буква, не использованная в имени других дисков.

#### CIFS

Для подключения файлового хранилища выполните команду, указанную в его [свойствах](#prosmotr_informacii_o_faylovom_hranilishche).

Команда для подключения хранилища выглядит так:

```bash
net use <Имя диска>: <Точка подключения>
```

Здесь:

* `<Точка подключения>` — адрес файлового хранилища, указанный в его описании;
* `<Имя диска>` — заглавная латинская буква, не использованная в имени других дисков.

### Linux

<info>

Инструкция приведена для Ubuntu Linux. О подключении в других Unix-подобных ОС читайте в документации разработчика.

</info>

#### NFS

1. Установите пакет `nfs-common` с помощью команды:

    ```bash
    sudo apt-get install nfs-common
    ```

2. Создайте папку для монтирования хранилища:

    ```bash
    mkdir <Имя каталога>
    ```

3. Используйте команду, указанную в [свойствах](#prosmotr_informacii_o_faylovom_hranilishche) созданного NFS хранилища:

    ```bash
    mount -t nfs <Точка подключения> /<Имя каталога>
    ```

    Здесь:

    * `<Точка подключения>` — адрес файлового хранилища, указанный в его описании;
    * `<Имя каталога>` — по умолчанию совпадает с названием файлового хранилища.

#### CIFS

1. Установите `cifs-utils` с помощью команды:

    ```bash
    sudo apt install -y cifs-utils
    ```

2. Создайте папку для монтирования хранилища:

    ```bash
    mkdir <Имя каталога>
    ```

3. Используйте команду, указанную в [свойствах](#prosmotr_informacii_o_faylovom_hranilishche) хранилища:

    ```bash
    sudo mount -o user=,password= -t cifs <Точка подключения> ./<Имя каталога>
    ```

    Здесь:

    * `<Точка подключения>` — адрес файлового хранилища, указанный в его описании;
    * `<Имя каталога>` — имя каталога, созданного ранее.

</tabpanel>
</tabs>

## Просмотр списка файловых хранилищ

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужное файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**. Отобразится список файловых хранилищ.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

1. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

1. Выполните команду:

    ```bash
    manila list
    ```

</tabpanel>
</tabs>

## Просмотр информации о файловом хранилище

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужное файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**.
1. Нажмите на имя нужного файлового хранилища. Отобразится информация о нем.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

1. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

1. Выполните команду:

    ```bash
    manila show <ID хранилища>
    ```

</tabpanel>
</tabs>

## Увеличение размера файлового хранилища

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужное файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**.
1. Раскройте меню нужного хранилища и выберите пункт **Изменить размер**.
1. Введите значение и нажмите **Подтвердить**.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

1. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

1. Выполните команду:

    ```bash
    manila extend <ID хранилища> <новый размер>
    ```

</tabpanel>
</tabs>

<info>

Размер файлового хранилища нельзя уменьшить.

</info>

## Создание снимка

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужное файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**.
1. Раскройте меню нужного хранилища и выберите пункт **Создать снимок**.
1. (Опционально) Измените название снимка и добавьте описание.
1. Введите значение и нажмите **Создать снимок**.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

1. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

1. Выполните команду:

    ```bash
    manila snapshot-create --name <название снимка> <ID хранилища>
    ```

</tabpanel>
</tabs>

## Просмотр снимков

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужное файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**.
1. Раскройте меню нужного хранилища и выберите **Список снимков**. Отобразится информация о снимках.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

1. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

1. Выполните команду:

    ```bash
    manila snapshot list --share-id <ID хранилища>
    ```

</tabpanel>
</tabs>

## Восстановление из снимка

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужное файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**.
1. Раскройте меню нужного хранилища и выберите **Список снимков**.
1. Раскройте меню нужного снимка и выберите **Восстановить файловое хранилище**.
1. Нажмите **Подтвердить**. Начнется процесс создания нового хранилища из снимка.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

1. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

1. Выполните команду:

    ```bash
    manila create --snapshot-id <ID снимка> <протокол> <размер>
    ```

</tabpanel>
</tabs>

## Добавление правила доступа

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужное файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**.
1. Нажмите на имя нужного файлового хранилища.
1. Перейдите на вкладку **Правила доступа**.
1. Нажмите на **Добавить новое правило**.
1. Укажите IP или адрес подсети источника и режим доступа.
1. Нажмите **Добавить правило**.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

2. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

3. Добавьте правило доступа с помощью команды:

    ```bash
    manila access-allow <ID файлового хранилища> ip <адрес сети в формате CIDR>
    ```

4. Проверьте, что правило создано успешно:

    ```bash
    manila access-list <ID файлового хранилища>
    ```

</tabpanel>
</tabs>

## Удаление файлового хранилища

Для удаления файлового хранилища необходимо сначала демонтировать его на виртуальных машинах.

<tabs>
<tablist>
<tab>Личный кабинет</tab>
<tab>OpenStack CLI</tab>
</tablist>
<tabpanel>

1. [Перейдите](https://msk.cloud.vk.com/app/) в личный кабинет VK Cloud.
1. Выберите проект, где находится нужное файловое хранилище.
1. Перейдите в раздел **Облачные вычисления** → **Файловое хранилище**.
1. Раскройте меню нужного хранилища и выберите **Удалить**.
1. Нажмите **Подтвердить**.

</tabpanel>
<tabpanel>

1. Убедитесь, что клиент OpenStack [установлен](/ru/manage/tools-for-using-services/openstack-cli#1_ustanovite_klient_openstack), и [пройдите аутентификацию](/ru/manage/tools-for-using-services/openstack-cli#3_proydite_autentifikaciyu) в проекте.

1. Убедитесь, что Manila CLI [установлен](../../../../base/account/project/cli/packagessetup).

1. Выполните команду:

    ```bash
    manila delete <ID хранилища>
    ```

</tabpanel>
</tabs>
