## Шаблоны конфигурации

При создании кластеров Kubernetes можно выбрать различные [шаблоны конфигураций](/ru/base/iaas/concepts/vm-concept#shablony_konfiguraciy) виртуальных машин, которые определяют вычислительные ресурсы, доступные узлам кластера. Часть шаблонов доступна сразу, а часть — по запросу в [службу поддержки](/ru/contacts/).

Рекомендации по выбору CPU и RAM для кластеров:

- Для небольших тестовых кластеров: 1 vCPU, 2 или 4 GB RAM.

- Для большинства кластеров: от 2 до 6 vCPU, от 2 до 24 GB RAM.

- Для высокопроизводительных кластеров: от 8 до 16 vCPU, от 8 до 64 GB RAM.

По запросу в [службу технической поддержки](/ru/contacts) становятся доступны:

- Шаблоны с высокопроизводительными CPU: от 16 vCPU, от 64 GB RAM. Эти процессоры более производительные.

- Индивидуальные шаблоны конфигурации под особые потребности.

<info>

Стоимость пользовательских конфигураций и конфигураций с высокопроизводительными CPU рассчитывается индивидуально.

</info>

## Расчет подходящей конфигурации кластера

Чтобы кластер Kubernetes работал стабильно:

1. Оцените объем ресурсов, требуемый для планируемой рабочей нагрузки.
1. Создайте кластер со следующими параметрами:

   - **Количество vCPU:** на 5-10% больше, чем расчетное количество для планируемой нагрузки.
   - **Количество RAM:** на 20% больше, чем расчетный объем для планируемой нагрузки.
   - **Объём хранилища:** на 10% больше, чем планируемый объем данных.
   - **Тип хранилища:** `Ceph SSD` или `High-IOPS SSD`.
   - **Количество master-узлов:** нечетное число для отказоустойчивой конфигурации (не менее трех).
   - **Количество worker-узлов:** на 10% больше, чем расчетное количество для планируемой нагрузки.

## Расчет доступных вычислительных ресурсов CPU и RAM

Каждый узел в кластере Kubernetes выполняет службу kubelet – агент Kubernetes. Kubelet, системные процессы и сама операционная система требуют определенного количества ресурсов, что означает, что не все ресурсы узла доступны для запуска контейнеров.

В большинстве случаев ресурсы CPU резервируются следующим образом:

- 6% от первого ядра.
- 1% от второго ядра (до 2 ядер).
- 0.5% от следующих двух ядер (до 4 ядер).
- 0.25% от всех ядер выше четырех.

Для памяти резервирование может выглядеть так:

- 25% из первых 4 GB памяти.
- 20% из следующих 4 GB (до 8 GB).
- 10% из следующих 8 GB (до 16 GB).
- 6% из следующих 112 GB (до 128 GB).
- 2% от любой памяти выше 128 GB.

Также стоит учесть порог вытеснения (eviction threshold), который обычно составляет 100MB. Это количество памяти, ниже которого kubelet начинает вытеснять поды из-за недостатка памяти.

Более крупные узлы потенциально могут использовать ресурсы более эффективно, т.к. процентное резервирование может оказаться меньшим по сравнению с меньшими узлами. Однако при планировании масштабируемости необходимо учитывать время, требуемое на запуск дополнительных узлов, а также вопросы отказоустойчивости, помня о том, что при добавлении узлов может понадобиться время на подтягивание и кеширование образов контейнеров.

При выборе размера узлов и их количества в вашем кластере, отдавайте предпочтение тому распределению, которое максимизирует использование ресурсов при сохранении требуемого уровня отказоустойчивости и масштабируемости.

## Доступные вычислительные ресурсы на ноде

Доступные CPU и RAM для разных категорий виртуальных машин:

| Тип ВМ | Node CPU | Node RAM | Доступно CPU | Доступно RAM |
| --- | --- | --- | --- | --- |
| Basic | 1 | 2 |	0,94 | 1,4 |
| Basic | 1 | 4 |	0,94 | 2,9 |
| Standard | 2 | 2 |	1,87 | 1,4 |
| Standard | 2	| 4 | 1,87 | 2,9 |
| Standard | 2	| 8 |	1,87 | 6,1 |
| Standard | 4 | 8 |	3,74 | 6,1 |
| Standard | 4 | 12 | 3,74 | 9,7 |
| Standard | 4 | 16 | 3,74 | 13,3 |
| Standard | 6 | 6 |	5,615 | 4,5 |
| Standard | 6	| 12 | 5,615 |	9,7 |
| Standard | 6 | 18 | 5,615 |	15,18 |
| Standard | 6	| 24 | 5,615 |	20,82 |
| Advanced | 8 | 8 |	7,49 | 6,1 |
| Advanced | 8	| 16 | 7,49 | 13,3 |
| Advanced | 8 | 24 | 7,49 | 20,82 |
| Advanced | 8	| 32 | 7,49	| 28,34 |
| Advanced | 12 |	12 | 11,24 | 9,7 |
| Advanced | 12 | 24 | 11,24 | 20,82 |
| Advanced | 12 | 36 | 11,24 | 32,1 |
| Advanced | 12 |	48	| 11,24 | 43,38 |
| Advanced | 16 |	16 | 14,99 | 13,3 |
| Advanced | 16 | 32 | 14,99 | 28,34 |
| Advanced | 16 | 48	| 14,99 | 43,38 |
| Advanced | 16 | 64	| 14,99 | 58,42 |

Доступные вычислительные ресурсы на ноде:

|Node CPU |	CPU Available | Node Ram (GB) | Node RAM Capacity (Ki) |	Ram Allocatable (Ki)	| Ram Allocatable (Mi) |
| --- | --- | --- | --- | --- | --- |
| 1 | 0,94 | 2 | 2 005 132 | 1 641 612 | 1 603 |
| 2 | 1,93 | 4 | 4 000 132 | 2 849 156 | 2 782 |
| 4 |	3,92 | 6	| 6 056 116 | 4 905 140 | 4 790 |
| 6 | 5,915 | 8 |	8 122 536 | 6 132 699 | 5 989 |
| 8 |	7,91 | 12 |	12 238 576 |	10 248 739 | 10 009 |
| 12 | 11,9 | 16 | 16 365 320 | 13 536 622 |	13 219 |
| 16 | 15,89 |	18 | 18 406 708 |	15 452 181 | 15 090 |
|    |       | 24 | 24 599 856 | 21 267 842 | 20 769 |
|    |       | 32 | 32 856 944 | 29 021 613 | 28 341 |
|    |       | 36 | 36 935 672 | 32 848 683 | 32 079 |
|    |       | 48 | 49 321 092 | 44 479 128 | 43 437 |
|    |       | 64 | 65 836 152 |	59 987 556 | 58 582 |

<info>

При изменении типа ВМ группы узлов, резервируемые ресурсы не изменяются, так как они задаются при создании ноды.

</info>

В дополнение к зарезервированным ресурсам, на нодах создаются системные поды, которые работаю постоянно и также потребляют память:

| Наименования пода | CPU Requests | CPU Limits | Memory Requests | Memory Limits |
| --- | --- | --- | --- | --- |
| calico-node | 100 m | 0 | 512 Mi | 0 |
| сsi-cinder-nodeplugin | 75 m | 300 m | 96 Mi | 384 Mi |
| haproxy | 20 m | 800 m | 80 Mi | 500 Mi |
